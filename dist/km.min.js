define("km/ajax",["jquery","km/loading","km/popTips","km/validate","km/validateTooltips"],function($,Loading,popTips,Validate,ValidateTooltips){var Ajax=function(){function getFullUrl(t){var e=window.location,i=""+e.protocol+"//"+e.host+t;return i}function init(){var ajax=function(type,url,data,config){var config=$.extend(!0,{returnUrl:{enable:!0,url:location.href},redirectEnable:!0,loadingEnable:!0,popTips:{enable:!0,delay:600,inCallback:!0}},config);if(data=data||{},config.returnUrl.enable&&"object"==typeof data){var href=config.returnUrl.url;-1!=href.indexOf("#")&&-1!=href.lastIndexOf("?")&&href.lastIndexOf("?")>href.indexOf("#")&&(href=href.substr(0,href.lastIndexOf("?"))),data.returnUrl=href}var dtd=$.Deferred();return config.loadingEnable&&Loading.show(),$.ajax({url:url,type:type,data:data,dataType:"json",traditional:!0,cache:!1}).done(function(ret){if("string"==typeof ret)try{ret=eval("(0,"+ret+")")}catch(e){return dtd.resolve(ret),dtd.promise()}ret.Url=$.trim(ret.Url||""),ret.Status?ret.Message&&config.popTips.enable?config.popTips.inCallback?popTips.success(ret.Message,config.popTips.delay,function(){config.redirectEnable&&ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)}):(popTips.success(ret.Message,config.popTips.delay),config.redirectEnable&&ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)):ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret):ret.ErrorMessage&&config.popTips.enable?config.popTips.inCallback?popTips.error(ret.ErrorMessage||"发生了未知错误",config.popTips.delay,function(){ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)}):(popTips.error(ret.ErrorMessage||"发生了未知错误",config.popTips.delay),config.redirectEnable&&ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)):config.redirectEnable&&ret.Url&&ret.Url.length>0?window.location.href=ret.Url:dtd.resolve(ret)}).fail(function(){popTips.enable&&popTips.error("服务器发生错误",config.popTips.delay),dtd.reject()}).always(function(){Loading.hide()}),dtd.promise()};return{post:function(t,e,i){return ajax("POST",t,e,i)},get:function(t,e,i){return ajax("GET",t,e,i)},ajaxForm:function(t,e){var i,o,s,n;t.valid||(i=t.data("validate")),o=t.attr("action"),s=t.attr("method"),n=t.serialize();var a=location.href;-1!=a.indexOf("#")&&-1!=a.lastIndexOf("?")&&a.lastIndexOf("?")>a.indexOf("#")&&(a=a.substr(0,a.lastIndexOf("?"))),n+="&returnUrl="+encodeURIComponent(a);var h=$.Deferred(),r={Status:!1,ErrorMessage:"验证失败"};return i&&i.valid?i.valid()?ajax(s,o,n,e):(h.reject(r),h.promise()):t.valid?t.valid()?ajax(s,o,n,e):(h.reject(r),h.promise()):ajax(s,o,n,e)}}}var _instance;return{getInstance:function(){return _instance||(_instance=init()),_instance}}}();return Ajax.getInstance()}),define("km/app",["jquery","km/router","km/util","km/popTips","km/loading","km/event"],function(t,e,i){var o=function(e,i){this.$el=e,this._route={},this.config=t.extend({idPrefx:"app-view-",viewClass:"app-view",animateClass:"animated bounceInRight",Template:null},i||{}),this._view={},this.viewId=-1,this.window=window};return o.prototype.route=function(t,e,i){return i||(i=e,e=null),this._route[t]=[e,i],this},o.prototype.run=function(){var t=this,i=new e;for(var o in t._route)!function(e){var o=t._route[e];i.map(e,o[0],function(e){t.callView(o[1],e||{})})}(o);i.init()},o.prototype.callView=function(e,i){var o,s,n,a=this,h=!1,r=this.window.location.hash;if(this._view[e]?(o=this._view[e].$el,s=this._view[e].hash,n=this._view[e].instance):(o=t('<div id="'+this.config.idPrefx+ ++this.viewId+'" class="'+this.config.viewClass+'"></div>'),s=r,this._view[e]={$el:o,params:i,hash:s,instance:null},this.$el.append(o),h=!0),(s!=r||h)&&(this._view[e].hash=r,n=this._view[e].instance,require([e],function(t){n||(n=new t(o,a),a._view[e].instance=n),n.destroy&&n.destroy(),n.run(i)})),this.viewName){var l=this._view[this.viewName].$el,d=this._view[this.viewName].instance;d&&"function"==typeof d.hide&&d.hide(),l.hide().removeClass(this.config.animateClass)}o.show().addClass(this.config.animateClass),n&&"function"==typeof n.show&&n.show(),this.viewName=e},o.View=function(t,e){this.$el=t,this.app=e,e.config.Template&&(this.Template=e.config.Template)},o.View.prototype.run=function(t){this.context=t},o.View.extend=function(e){e=t.extend({initialize:function(){}},e||{});var s=function(t,e){o.View.call(this,t,e)};s.prototype=i.createProto(o.View.prototype);for(var n in e)s.prototype[n]=e[n];return s},o}),define("km/autoComplete",["jquery"],function(t){var e={LEFT:37,UP:38,RIGHT:39,DOWN:40,TAB:9,ENTER:13},i=function(e,i){this.$element=e,this.options=t.extend(!0,{url:null,zIndex:1e3,data:[],max:10,width:null,height:null,isBottom:!0,highlight:!1,formatItem:function(t){return t},callback:{setValue:null}},i),this.tpl='<div class="k-autocomplete k-pop-panel"></div>',this.active=0,this.init()};return i.prototype.init=function(){var i=this;this.$listBox=t(this.tpl).hide().appendTo(document.body),this.data=this.options.data||[],this.$element.on("keyup",function(o){var s=t(this),n=t.trim(s.val());switch(i.cache?i.cache!=n&&(i.cache=n,i.search(n),i.active=0):(i.cache=n,i.search(n),i.active=0),o.keyCode){case e.UP:case e.LEFT:o.preventDefault(),i.prev();break;case e.DOWN:case e.RIGHT:i.next();break;case e.ENTER:case e.TAB:i.select()}}),this.$listBox.on("click.autocomplete","li",function(){var e=t(this).text();if(i.$element.val(e).focus(),t.isFunction(i.options.callback.setValue)){var o=i.getItem(e);i.options.callback.setValue(o)}}),t(document).on("click.autocomplete",function(){i.hide()}),t(window).on("resize.autocomplete",function(){i.setCss()})},i.prototype.search=function(e){var i=this;if(this.options.url)t.ajax({mode:"abort",type:"GET",url:this.options.url,cache:!1,data:{keyword:e}}).done(function(t){if(t&&t instanceof Array){var o;i.data=t,o=i.getData(e),i.build(e,o),i.show()}});else if(this.options.proxy)this.options.proxy(e,function(t){i.data=t,t=i.getData(e),i.build(e,t),i.show()});else{var o=this.getData(e);this.build(e,o),this.show()}},i.prototype.getData=function(t){this.cacheData=[];var e=[],i=0;if(0===t.length)return e;for(var o,s=0;s<this.data.length;s++)if(o=this.options.formatItem(this.data[s]),o.toLowerCase().indexOf(t.toLowerCase())>=0){if(this.cacheData.push(this.data[s]),e.push(o),i===this.options.max-1)break;i++}return e},i.prototype.build=function(t,e){if(this.$listBox.find("ul").remove(),this.$listItem=null,0!==e.length){for(var i="<ul>",o=0;o<e.length;o++)i+='<li class="'+(0==o?"active":"")+'">'+this.highlight(t,e[o])+"</li>";i+="</ul>",this.$listBox.append(i),this.$list=this.$listBox.find("ul"),this.$listItem=this.$listBox.find("li")}},i.prototype.highlight=function(t,e){if(this.options.highlight){var i=new RegExp("("+t+")","ig");return e=e.replace(i,"<strong>$1</strong>")}return e},i.prototype.show=function(){return t("div.k-pop-panel").hide(),this.hasItem()?(this.setCss(),void this.$listBox.show()):void this.hide()},i.prototype.getCss=function(){var t={left:this.$element.offset().left,top:this.$element.outerHeight()+this.$element.offset().top,width:this.options.width||this.$element.outerWidth()};return this.options.isBottom||(t.top=this.$element.offset().top-this.$listBox.outerHeight(!0)),t},i.prototype.setCss=function(){this.$list.css("max-height",this.options.height||"auto");var t=this.getCss();this.$listBox.css(t)},i.prototype.hide=function(){this.$listBox.hide()},i.prototype.prev=function(){this.moveSelect(-1)},i.prototype.next=function(){this.moveSelect(1)},i.prototype.hasItem=function(){return this.$listItem&&this.$listItem.length>0},i.prototype.moveSelect=function(t){if(this.hasItem()){this.active+=t,this.active<0?this.active=this.$listItem.length-1:this.active>this.$listItem.length-1&&(this.active=0);var e=this.$listItem.removeClass("active").eq(this.active).addClass("active"),i=0;this.$listItem.each(function(){i+=this.offsetHeight});var o=this.$list.scrollTop(),s=this.$list[0].clientHeight,n=e.height(),a=e.position().top;a>s?this.$list.scrollTop(a+n-s+o):0>a&&this.$list.scrollTop(o+a)}},i.prototype.select=function(){var e=this.$listBox.find("li.active"),i=e.text();if(this.$element.val(i),this.hide(),t.isFunction(this.options.callback.setValue)){var o=this.getItem(i);this.options.callback.setValue(o)}},i.prototype.getItem=function(t){var e=this.cacheData;if(e&&0!==e.length){for(var i,o=0;o<e.length;o++)if(i=this.options.formatItem(e[o]),t===i)return e[o];return null}},function(t,e){var o=new i(t,e);return o}}),define("km/cache",[],function(){var t={},e=window.localStorage;return t.set=function(i,o,s){if(!o)return void t.remove(i);var n;/^[1-9]\d*$/.test(s)&&(n=(new Date).getTime()+1e3*parseInt(s));var a={value:o,expired:n};e.setItem(i,JSON.stringify(a))},t.get=function(i){var o=e.getItem(i),s=null;return o&&(o=JSON.parse(o),o.expired&&(new Date).getTime()>o.expired?t.remove(i):s=o.value),s},t.remove=function(t){e.removeItem(t)},t.clear=function(){e.clear()},t}),define("km/clipZoom",["jquery","km/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend(!0,{imgUrl:"",scale:!0,width:400,height:300,selectorWidth:120,selectorHeight:100,callback:{clip:null}},i),this.$selector=e.find(".selector"),this.$clipZoomBox=e.find(".k-clipZoom-Box").width(this.options.width).height(this.options.height),this.$container=this.$clipZoomBox.find(".k-container"),this.$mainImg=this.$container.find("img"),this.$viewBox=e.find(".view-box"),this.$viewImg=this.$viewBox.find("img"),this.$resultBox=e.find(".result-box"),this.$resultImg=this.$resultBox.find("img"),this.init()};return i.prototype.init=function(){var t=this;this.$selector.width(this.options.selectorWidth).height(this.options.selectorHeight),this.$viewBox.width(this.options.selectorWidth).height(this.options.selectorHeight),this.selectorDnd=new e({$layer:this.$selector,$range:this.$clipZoomBox,resizable:!0,scale:this.options.scale,callback:{resize:function(){t.setPreview()},move:function(){t.setPreview()}}}),this.imgLoad(),this.eventBind()},i.prototype.eventBind=function(){var t=this;this.$element.on("click.clipzoom",'[role="clip"]',function(){t.clip()}).on("click.clipzoom",'[role="center"]',function(){t.center()}).on("click.clipzoom",'[role="reset"]',function(){t.reset()}).on("click.clipzoom",'[role="plus"]',function(){t.zoom(!0)}).on("click.clipzoom",'[role="minus"]',function(){t.zoom(!1)})},i.prototype.setImgSize=function(t,e){this.$mainImg.width(t).height(e)},i.prototype.imgLoad=function(){var t=this,i=new Image;i.onload=function(){var o=t.getSize(i.width,i.height,t.options.width);i.width<t.options.width&&(o.width=i.width,o.height=i.height),t.$container.width(o.width).height(o.height).css({left:0,top:0}),t.$mainImg.attr("src",t.options.imgUrl).width(o.width).height(o.height),t.$viewImg.attr("src",t.options.imgUrl).width(o.width).height(o.height),t.resetSize={width:o.width,height:o.height,left:0,top:0},t.containerDnd=new e({$layer:t.$container,$range:t.$clipZoomBox,resizable:!0,boundary:!0,scale:!0,callback:{resize:function(e){t.setImgSize(e.width,e.height),t.setPreview()},move:function(){t.setPreview()}}}),t.setPreview()},i.onerr=function(){alert("图片加载失败")},i.src=this.options.imgUrl},i.prototype.getSize=function(t,e,i){var o;return t>=e?(o=t/e,e=i/o):(o=e/t,e=i*o),{width:parseInt(i),height:parseInt(e)}},i.prototype.zoom=function(t){var e,i=this.$container.width(),o=this.$container.height();e=t?i/.8:.8*i;var s=this.getSize(i,o,e);this.$container.width(s.width).height(s.height),this.$mainImg.width(s.width).height(s.height),this.$viewImg.width(s.width).height(s.height),this.setPreview()},i.prototype.clip=function(){var e={imgSource:this.options.imgUrl,imgWidth:this.$viewImg.width(),imgHeight:this.$viewImg.height(),imgX:Math.abs(this.$viewImg[0].style.marginLeft.replace("px",""))-this.$viewImg.position().left,imgY:Math.abs(this.$viewImg[0].style.marginTop.replace("px",""))-this.$viewImg.position().top,selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,cutterWidth:this.options.selectorWidth,cutterHeight:this.options.selectorHeight};t.isFunction(this.options.callback.clip)&&this.options.callback.clip(e)},i.prototype.center=function(){var t=parseInt(this.$mainImg.width()),e=parseInt(this.$mainImg.height()),i=parseInt(this.$selector.width()),o=parseInt(this.$selector.height()),s=parseInt(this.options.width),n=parseInt(this.options.height),a=this.getSize(t,e,i);a.height<o&&(a.width=t/e*o,a.height=o),this.$mainImg.width(a.width).height(a.height),this.$viewImg.width(a.width).height(a.height),this.$container.width(a.width).height(a.height).css({top:(n-a.height)/2,left:(s-a.width)/2}),this.$selector.css({top:(n-o)/2,left:(s-i)/2}),this.setPreview()},i.prototype.reset=function(){this.$container.width(this.resetSize.width).height(this.resetSize.height).css({left:0,top:0}),this.$mainImg.width(this.resetSize.width).height(this.resetSize.height),this.$viewImg.width(this.resetSize.width).height(this.resetSize.height),this.setPreview()},i.prototype.setPreview=function(){{var t=this.options,e=this.getPreviewInfo(),i=t.selectorWidth,o=t.selectorHeight;e.viewPortWidth,e.viewPortHeight}if(e.selectorWidth>0){var s=i/e.selectorWidth,n=o/e.selectorHeight;this.$viewImg.css({width:Math.round(s*e.imgWidth),height:Math.round(n*e.imgHeight),left:Math.round(s*e.imgX),top:Math.round(n*e.imgY),marginLeft:-Math.round(s*e.selectorX),marginTop:-Math.round(n*e.selectorY)})}},i.prototype.getPreviewInfo=function(){var t=this.options;return{imgWidth:this.$mainImg.width(),imgHeight:this.$mainImg.height(),imgX:this.$container.position().left,imgY:this.$container.position().top,selectorWidth:this.$selector.width(),selectorHeight:this.$selector.height(),selectorX:this.$selector.position().left,selectorY:this.$selector.position().top,viewPortWidth:t.width,viewPortHeight:t.height}},i}),define("km/contextMenu",["jquery"],function(t){var e=function(e,i){this.$el=e,this.options=t.extend(!0,{target:"",className:"k-contextMenu",items:[],callback:{onShow:t.noop}},i),this.$curTarget=null,this.tm=null,this.init()};return e.prototype.init=function(){0!=this.options.items.length&&0!=this.$el.length&&(this.build(),this.watch())},e.prototype.watch=function(){var e=this;this.$el.on("contextmenu.contextmenu",this.options.target,function(i){var o=i.pageX,s=i.pageY;return e.$curTarget=t(this),e.tm=setTimeout(function(){e.$contextMenu.css({left:o,top:s,display:"block"}),e.options.callback.onShow.call(e)},100),!1}),this.$contextMenu.on("click.contextmenu","li",function(){var i=t(this),o=i.text(),s=e.items[o];s&&"function"==typeof s.func&&s.func(e.$curTarget)}),t(document.body).on("click.contextmenu",function(){e.$contextMenu.hide(),e.$curTarget=null})},e.prototype.build=function(){var e=[];this.items={},e.push('<ul class="'+this.options.className+'">');for(var i=0;i<this.options.items.length;i++)e.push("<li>"+this.options.items[i].text+"</li>"),this.items[this.filterHtml(this.options.items[i].text)]=this.options.items[i];e.push("</ul>"),this.$contextMenu=t(e.join("")),this.$contextMenu.appendTo(document.body)},e.prototype.filterHtml=function(t){return t.replace(/<[^>]*>/gi,"")},function(t,i){var o=new e(t,i);return o}}),define("km/datePicker",["jquery"],function($){var dates={months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],daysShort:["周日","周一","周二","周三","周四","周五","周六"],daysMin:["日","一","二","三","四","五","六"]},date=new Date,DatePicker=function(t,e){var i=this;this.$element=t,this.options=$.extend(!0,{position:"left",desktop:!1,data:[],appendTo:$(document.body),showTime:!1,year:{min:date.getFullYear()-100,max:date.getFullYear()+100},format:"yyyy-MM-dd",inputGroup:".k-input-group",positionProxy:function(){return i.getPosition()},minDate:null,maxDate:null,zIndex:2e3},e),this.isInput=this.$element.is("input"),this.year=date.getFullYear(),this.month=date.getMonth()+1,this.day=date.getDate(),this.index=0,this.isSetTime=!1,this.selectDay=!1,this.event={selected:[],clean:[],change:[]},this.init()};return DatePicker.prototype.on=function(t,e){return $.isArray(this.event[t])&&this.event[t].push(e),this},DatePicker.prototype.getPosition=function(){var t={left:0,top:0},e=this.options.appendTo[0],i=this.$element[0];do t.left+=i.offsetLeft-i.scrollLeft,t.top+=i.offsetTop-i.scrollTop;while((i=i.offsetParent)&&i!=e);if("left"!=this.options.position){var o=t.left+this.$element.outerWidth(),s=t.left+this.$datepicker.outerWidth();t.left=t.left-(s-o)}return{left:t.left,top:t.top+this.$element[0].offsetHeight+2,zIndex:this.options.zIndex}},DatePicker.prototype.init=function(){this.isInput&&this.$element.attr("readonly","readonly"),this.$groupBox=this.$element.parent(this.options.inputGroup),this.initMinMaxDate(),this.canBuild()?(this.createPanel(),this.eventBind()):console.log("最大日期必须大于最小日期")},DatePicker.prototype.initMinMaxDate=function(){var t=new Date;this.options.minDate&&(this.minDate="today"===this.options.minDate?t:new Date(this.options.minDate.replace(/-/g,"/")),this.options.year.min=this.minDate.getFullYear()),this.options.maxDate&&(this.maxDate="today"===this.options.maxDate?t:new Date(this.options.maxDate.replace(/-/g,"/")),this.options.year.max=this.maxDate.getFullYear()),this.maxDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(t,"yyyyMMdd")?(this.year=this.maxDate.getFullYear(),this.month=this.maxDate.getMonth()+1,this.day=this.maxDate.getDate()):this.minDate&&this.format(this.minDate,"yyyyMMdd")>this.format(t,"yyyyMMdd")&&(this.year=this.minDate.getFullYear(),this.month=this.minDate.getMonth()+1,this.day=this.minDate.getDate())},DatePicker.prototype.canBuild=function(){return this.maxDate&&this.minDate&&this.format(this.maxDate,"yyyyMMdd")<this.format(this.minDate,"yyyyMMdd")?!1:!0},DatePicker.prototype.eventBind=function(){var t=this;this.$groupBox.on("click.datepicker","button",function(){return t.show(),!1}),this.$element.on("click.datepicker",function(){return t.options.desktop?void 0:(t.show(),!1)}),this.$datepicker.on("click.datepicker",function(e){var i=e.target,o=$(i);return"year"===i.id||"month"===i.id||o.parents(".year-box:eq(0)").length>0||o.parents(".month-box:eq(0)").length>0?!1:(t.yearBoxToggle(!1),t.monthBoxToggle(!1),t.timePanelHide(),!1)}).on("click.datepicker","[role=prev]",function(){t.month--,t.prevToggle(),t.month<1&&(t.month=12,t.year--),t.$next.show(),t.createDays(),t.change()}).on("click.datepicker","[role=next]",function(){t.month++,t.nextToggle(),t.month>12&&(t.month=1,t.year++),t.$prev.show(),t.createDays(),t.change()}).on("click.datepicker","#month",function(){t.monthBoxToggle(!0),t.yearBoxToggle(!1),t.timePanelHide()}).on("click.datepicker",".month-box li",function(){var e=$(this),i=e.attr("data-month");e.hasClass("disabled")||(t.month=Number($.trim(i)),t.monthBoxToggle(!1),t.createDays(),t.prevToggle(),t.nextToggle(),t.change())}).on("click.datepicker","#year",function(){t.yearBoxToggle(!0),t.monthBoxToggle(!1),t.timePanelHide()}).on("click.datepicker",".year-box li",function(){var e=$(this),i=Number($.trim(e.text()));e.hasClass("cur")||e.hasClass("disabled")||(t.$yearBox.find("li").removeClass("cur"),e.addClass("cur"),t.year=Number(i),t.createDays(),t.yearBoxToggle(!1),t.prevToggle(),t.nextToggle(),t.change())}).on("click.datepicker","[role=yearPrev]",function(){0!==t.index&&(t.index--,t.toCurYearPanel())}).on("click.datepicker","[role=yearNext]",function(){t.index!==t.$yearItems.length-1&&(t.index++,t.toCurYearPanel())}).on("click.datepicker","[role=clear]",function(){t.isInput?t.$element.val(""):t.$element.data("value",""),t.isSetTime=!1,t.setTodayInfo(),t.createDays(),t.setViewInfo(),t.hide(),$.map(t.event.clean,function(t){t()})}).on("click.datepicker","[role=today]",function(){t.setTodayInfo(),t.createDays(),t.hide(),t.set(!0),t.setTime()}).on("click.datepicker","tbody td",function(){var e=$(this),i=e.attr("data-year"),o=e.attr("data-month"),s=e.attr("data-day");if(!e.hasClass("disabled")&&(i=Number(i),o=Number(o),s=Number(s),t.year=i,t.month=o,t.day=s,t.createDays(),!t.options.showTime)){if(t.set(),t.options.desktop)return;t.hide()}}).on("click.datepicker","span.hours",function(){return t.setTimePanelPosition($(this),t.$hoursBox),!1}).on("click.datepicker","span.minutes",function(){return t.setTimePanelPosition($(this),t.$minutesBox),!1}).on("click.datepicker","span.seconds",function(){return t.setTimePanelPosition($(this),t.$secondsBox),!1}).on("click.datepicker",".time-box li",function(){var e=$(this),i=e.attr("data-value"),o=e.text(),s=e.attr("data-target");switch(s){case"hours":t.hours=i,t.$hours.text(o);break;case"minutes":t.minutes=i,t.$minutes.text(o);break;case"seconds":t.seconds=i,t.$seconds.text(o)}}).on("click.datepicker","[role=confirm]",function(){var e=t.$datepicker.find("td span.active"),i=e.parent(),o=i.attr("data-year"),s=i.attr("data-month"),n=i.attr("data-day");t.isSetTime=!0,t.year=Number(o),t.month=Number(s),t.day=Number(n),t.hours=Number(t.$hours.text()),t.minutes=Number(t.$minutes.text()),t.seconds=Number(t.$seconds.text()),t.set(),t.hide()}),$(document).on("click.datepicker",function(){t.options.desktop||t.hide()})},DatePicker.prototype.createPanel=function(){var t,e=[];for(e.push('<div class="k-datepicker k-pop-panel"  data-desktop="'+(this.options.desktop?"true":"")+'" >'),e.push('<div class="k-container">'),e.push("<table>"),e.push("<thead>"),e.push("<tr>"),e.push('<th class="prev"  style="width:28px;"><i class="fa fa-chevron-left" role="prev"></i></th>'),e.push('<th colspan="5">'),e.push('<span id="year" style="margin-right:20px;">'+this.year+"</span>"),e.push('<span id="month">'+dates.months[this.month-1]+"</span>"),e.push("</th>"),e.push('<th class="next"  style="width:28px;"><i class="fa fa-chevron-right" role="next"></i></th>'),e.push("</tr>"),e.push("<tr>"),t=0;t<dates.daysMin.length;t++)e.push("<th>"+dates.daysMin[t]+"</th>");e.push("</tr>"),e.push("</thead>"),e.push("<tbody>"),e.push("</tbody>"),e.push("</table>"),e.push(this.getYearBox()),e.push(this.getMonthBox()),e.push('<div class="line"></div>'),e.push(this.getTimeBox()),e.push('<div class="operate-box" style="text-align:right;margin-bottom:5px;">'),e.push('<input type="button" value="清空" role="clear" class="k-btn k-btn-default" />&nbsp;');var i='<input type="button" value="今天" role="today" class="k-btn k-btn-success" />&nbsp;';return this.minDate&&this.maxDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")||!this.minDate&&!this.maxDate?e.push(i):this.minDate&&!this.maxDate&&this.format(this.minDate,"yyyyMMdd")<=this.format(new Date,"yyyyMMdd")?e.push(i):this.maxDate&&!this.minDate&&this.format(this.maxDate,"yyyyMMdd")>=this.format(new Date,"yyyyMMdd")&&e.push(i),this.options.showTime&&e.push('<input type="button" value="确定" role="confirm" class="k-btn k-btn-primary" />&nbsp;'),e.push("</div>"),e.push("</div>"),e.push("</div>"),this.$datepicker=$(e.join("")),this.$year=this.$datepicker.find("#year"),this.$yearBox=this.$datepicker.find(".year-box"),this.$yearItems=this.$yearBox.find("ul"),this.$month=this.$datepicker.find("#month"),this.$monthBox=this.$datepicker.find(".month-box"),this.$line=this.$datepicker.find(".line"),this.$timeBox=this.$datepicker.find(".time-box"),this.$operateBox=this.$datepicker.find(".operate-box"),this.$hours=this.$timeBox.find("span.hours"),this.$minutes=this.$timeBox.find("span.minutes"),this.$seconds=this.$timeBox.find("span.seconds"),this.$hoursBox=this.$timeBox.find(".hours-box"),this.$minutesBox=this.$timeBox.find(".minutes-box"),this.$secondsBox=this.$timeBox.find(".seconds-box"),this.$prev=this.$datepicker.find("th.prev i"),this.$next=this.$datepicker.find("th.next i"),this.index=this.$yearItems.find("li.cur").parent().show().index(),this.createDays(),this.options.showTime?this.$timeBox.show():this.$timeBox.hide(),this.options.desktop?(this.options.footerHtml&&this.$datepicker.append("<div>"+this.options.footerHtml+"</div>"),this.$line.hide(),this.$timeBox.hide(),this.$operateBox.hide(),void this.$datepicker.appendTo(this.$element).show().css({boxShadow:"none"})):void this.$datepicker.appendTo(0==this.options.appendTo.length?document.body:this.options.appendTo)},DatePicker.prototype.getYearBox=function(){var t,e,i,o=[],s=[],n=1,a=1,h=this.options.year.max-this.options.year.min+1,r=this.options.year.min-1;t=h%10===0?h/10:Number(h/10)+1;for(e=1;t>=e;e++){for(s.push("<ul>"),i=n;h>=i;i++){if(r+=1,s.push('<li id="li_'+r+'" class="'+(this.year===r?"cur":"")+'" >'+r+"</li>"),n++,a%10===0){a=1;break}a++}s.push("</ul>")}return o.push('<div class="year-box">'),o.push('<div class="year-box-container">'),o.push(s.join("")),o.push("</div>"),o.push('<div class="year-box-controls">'),o.push('<i class="fa fa-chevron-left" style="float:left;" role="yearPrev"></i>'),o.push('<i class="fa fa-chevron-right" style="float:right;" role="yearNext"></i>'),o.push("</div>"),o.push("</div>"),o.join("")},DatePicker.prototype.getMonthBox=function(){var t,e,i,o,s=[];for(s.push('<ul class="month-box">'),t=0;t<dates.months.length;t++)i=dates.months[t],e=t+1,s.push('<li class="'+o+'" data-month="'+(t+1)+'">'+i+"</li>");return s.push("</ul>"),s.join("")},DatePicker.prototype.getTimeBox=function(){var t,e=[];for(e.push('<div class="time-box">'),e.push('<ul class="hours-box">'),t=0;24>t;t++)e.push('<li data-target="hours" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="minutes-box">'),t=0;55>=t;t+=5)e.push('<li data-target="minutes" data-value='+t+">"+this.supStr(t)+"</li>");for(e.push("</ul>"),e.push('<ul class="seconds-box">'),t=0;55>=t;t+=15)e.push('<li data-target="seconds" data-value='+t+">"+this.supStr(t)+"</li>");return e.push("</ul>"),e.push('<div class="time-box-container">'),e.push("<span>时间：</span>"),e.push("<div >"),e.push('<span class="hours">'+date.getHours()+"</span>"),e.push("<span>:</span>"),e.push('<span class="minutes">'+date.getMinutes()+"</span>"),e.push("<span>:</span>"),e.push('<span class="seconds">'+date.getSeconds()+"</span>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")},DatePicker.prototype.createDays=function(t,e,i){function o(t){function e(t){return a.format(t,"yyyyMMdd")<a.format(a.minDate,"yyyyMMdd")?"disabled":""}function i(t){return a.format(t,"yyyyMMdd")>a.format(a.maxDate,"yyyyMMdd")?"disabled":""}if(a.minDate&&a.maxDate){var o=e(t),s=i(t);if(o.length>0)return o;if(s.length>0)return s}else{if(a.minDate)return e(t);if(a.maxDate)return i(t)}return""}var s,n,a=this;this.setSelectivelyDate(),t=t||this.year,e=e||this.month,i=i||this.day;var h=this.getMonthLastDay(t,e),r=this.getMonthLastDay(t,e-1),l=new Date(t,e-1,1).getDay(),d=new Array(42),p=[],c=42-h;for(s=0,n=l;h>s;s++,n++)d[n]={year:t,month:e,day:s+1,tdClass:o(new Date(t,e-1,s+1))},s+1===h&&(c=42-n);for(s=l,n=0;s>=1;s--,n++){var u;1===e?(u=o(new Date(t-1,11,r-s+1)),d[n]={year:t-1,month:12,day:r-s+1,tdClass:"old "+u}):(u=o(new Date(t,e-2,r-s+1)),d[n]={year:t,month:e-1,day:r-s+1,tdClass:"old "+u})}for(s=42-c+1,n=1;42>s;s++,n++){var u;12===e?(u=o(new Date(t+1,0,n)),d[s]={year:t+1,month:1,day:n,tdClass:"new "+u}):(u=o(new Date(t,e,n)),d[s]={year:t,month:e+1,day:n,tdClass:"new "+u})}var f,m,g,$=0,v=0;for(s=0;6>s;s++){for(p.push("<tr>"),n=$;42>n;n++)if(f=d[n],m=f.year===t&&f.month===e&&this.day===f.day?"today":"",g=this.getDotHtml(f.year+"-"+this.fixZero(f.month)+"-"+this.fixZero(f.day)),p.push('<td id="'+f.year+"_"+f.month+"_"+f.day+'" class="'+f.tdClass+"   "+m+'  " data-year="'+f.year+'" data-month="'+f.month+'" data-day="'+f.day+'"><span>'+f.day+"</span>"+g+"</td>"),$++,v++,7===v){v=0;break}p.push("</tr>")}this.$datepicker.find("tbody").html(p.join("")),this.setViewInfo(t,e,i)},DatePicker.prototype.fixZero=function(t){return t=String(t),0===t.length?"":1===t.length?t="0"+t:t},DatePicker.prototype.getDotHtml=function(t){if(!this.options.data||0===this.options.data.length)return"";for(var e,i=0;i<this.options.data.length;i++)if(e=this.options.data[i],e===t)return'<em class="dot"></em>';return""},DatePicker.prototype.getMonthLastDay=function(t,e){return new Date(new Date(t,e,1).getTime()-864e5).getDate()},DatePicker.prototype.yearBoxToggle=function(t){var e={left:this.$year.position().left,top:this.$year.position().top+this.$year.outerHeight()-2};t?(this.$year.addClass("selected"),this.$yearBox.show().css(e)):(this.$year.removeClass("selected"),this.$yearBox.hide())},DatePicker.prototype.monthBoxToggle=function(t){var e={left:this.$month.position().left,top:this.$month.position().top+this.$month.outerHeight()-2};t?(this.$month.addClass("selected"),this.$monthBox.show().css(e)):(this.$month.removeClass("selected"),this.$monthBox.hide())},DatePicker.prototype.timePanelHide=function(){this.$hoursBox.hide(),this.$minutesBox.hide(),this.$secondsBox.hide()},DatePicker.prototype.toCurYearPanel=function(){this.$yearItems.hide().eq(this.index).show()},DatePicker.prototype.prevToggle=function(){var t=1;this.minDate?t=this.minDate.getMonth()+1:this.maxDate&&(t=this.maxDate.getMonth()+1),this.year===this.options.year.min&&this.month===t?this.$prev.hide():this.$prev.show()},DatePicker.prototype.nextToggle=function(){var t=12;this.maxDate?t=this.maxDate.getMonth()+1:this.minDate&&(t=this.minDate.getMonth()+1),this.year===this.options.year.max&&this.month===t?this.$next.hide():this.$next.show()},DatePicker.prototype.setSelectivelyDate=function(){function t(t){var e=n.minDate.getFullYear(),o=n.minDate.getMonth()+1,s=n.minDate.getDate();e==n.year&&(o>n.month&&(n.month=o,s<n.day&&(n.day=s)),n.month==o&&s>n.day&&(n.day=s),i(t,o))}function e(t){var e=n.maxDate.getFullYear(),i=n.maxDate.getMonth()+1,s=n.maxDate.getDate();e==n.year&&(i<n.month&&(n.month=i,s>n.day&&(n.day=s)),i==n.month&&s<n.day&&(n.day=s),o(t,i))}function i(t,e){t.each(function(){var t=$(this),i=t.attr("data-month");e>i&&t.addClass("disabled")})}function o(t,e){t.each(function(){var t=$(this),i=t.attr("data-month");i>e&&t.addClass("disabled")})}var s=this.$monthBox.find("li").removeClass("disabled"),n=this;this.minDate&&this.maxDate?(t(s),e(s)):this.minDate?t(s):this.maxDate&&e(s)},DatePicker.prototype.showInit=function(){var t;if(t=$.trim(this.isInput?this.$element.val():this.$element.data("value")),0!==t.length){var e=/(\d{4}).{1}(\d{2}).{1}(\d{2})/,i=/(\d{2}):(\d{2}):(\d{2})/,o=t.match(e),s=t.match(i);o&&o.length>0&&(this.year=Number(o[1]),this.month=Number(o[2]),this.day=Number(o[3])),s&&s.length>0&&(this.hours=Number(s[1]),this.minutes=Number(s[2]),this.seconds=Number(s[3]))}},DatePicker.prototype.show=function(){$("div.k-pop-panel").each(function(){var t=this.getAttribute("data-desktop");t&&"true"==t||$(this).hide()}),this.options.showTime&&!this.isSetTime?(this.setTodayInfo(),this.createDays(),this.setViewInfo(),this.setTime()):(this.showInit(),this.createDays(),this.setViewInfo());var t=this.options.positionProxy();this.$datepicker.show().css(t)},DatePicker.prototype.hide=function(){this.$datepicker.hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1),this.timePanelHide()},DatePicker.prototype.setTimePanelPosition=function(t,e){var i={left:t.position().left-1,top:t.position().top-e.outerHeight()};e.show().css(i).siblings("ul").hide(),this.yearBoxToggle(!1),this.monthBoxToggle(!1)},DatePicker.prototype.setTodayInfo=function(){var t=new Date;this.year=t.getFullYear(),this.month=t.getMonth()+1,this.day=t.getDate(),this.hours=t.getHours(),this.minutes=t.getMinutes(),this.seconds=t.getSeconds()},DatePicker.prototype.setViewInfo=function(t,e,i){t=t||this.year,e=e||this.month,i=i||this.day,this.prevToggle(),this.nextToggle(),this.$year.html(t),this.$month.html(dates.months[e-1]),this.$yearBox.find("li").removeClass("cur"),this.$yearBox.find("#li_"+t).addClass("cur").parent().show().siblings().hide(),this.$datepicker.find("tbody td span").removeClass("active"),this.$datepicker.find("#"+t+"_"+e+"_"+i).children().addClass("active"),this.index=this.$yearItems.find("li.cur").parent().show().index()},DatePicker.prototype.setTime=function(){var t=new Date,e=t.getHours(),i=t.getMinutes(),o=t.getSeconds();this.$hours.text(this.supStr(this.isSetTime?this.hours||e:e)),this.$minutes.text(this.supStr(this.isSetTime?this.minutes||i:i)),this.$seconds.text(this.supStr(this.isSetTime?this.seconds||o:o))
},DatePicker.prototype.set=function(t){var e=this.getDateValue(t);this.isInput?this.$element.val(e).focus().blur():this.$element.data("value",e),$.map(this.event.selected,function(t){t(e)})},DatePicker.prototype.change=function(t){var e=this.getDateValue(t);$.map(this.event.change,function(t){t(e)})},DatePicker.prototype.getDateValue=function(t){t=t||!1,this.isSetTime=!0;var e=new Date,i=t?e.getFullYear():this.year,o=t?e.getMonth():this.month-1,s=t?e.getDate():this.day,n=t||!this.options.showTime?e.getHours():this.hours||e.getHours(),a=t||!this.options.showTime?e.getMinutes():this.minutes||e.getMinutes(),h=t||!this.options.showTime?e.getSeconds():this.seconds||e.getSeconds(),r=new Date(i,o,s,n,a,h),l=this.format(r);return l},DatePicker.prototype.format=function(t,e){t=t||new Date;var i,o,e=e||this.options.format.replace(/"/g,""),s={"y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(i in s)new RegExp("("+i+")").test(e)&&(o=s[i],e=e.replace(RegExp.$1,1===o.toString().length?"0"+o.toString():o));return e},DatePicker.prototype.supStr=function(t){return t=String(t),1===t.length?"0"+t:t},DatePicker.Global=function($elements){$elements=$elements||$(document.body).find('input[data-module="datepicker"]'),$elements.each(function(){var $this=$(this),options=$this.attr("data-options"),format=$this.attr("data-format"),showTime=$this.attr("data-showTime"),minDate=$this.attr("data-minDate"),maxDate=$this.attr("data-maxDate"),position=$this.attr("data-position"),appendTo=$this.attr("data-appendTo"),onSelected=$this.attr("data-onselected"),onClean=$this.attr("data-onclean"),data=$this.data("datepicker");showTime=showTime?"true"===showTime:!1,onSelected=onSelected&&onSelected.length>0?eval("(0,"+onSelected+")"):null,onClean=onClean&&onClean.length>0?eval("(0,"+onClean+")"):null,options=options&&options.length>0?eval("(0,"+options+")"):{format:format,showTime:showTime,minDate:minDate,maxDate:maxDate,position:position||"left",appendTo:$(appendTo||document.body)},data||(data=new DatePicker($this,options),onSelected&&data.on("selected",onSelected),onClean&&data.on("clean",onClean),$this.data("datepicker",data))})},DatePicker}),define("km/dragdrop",["jquery"],function(t){var e=1e3,i=[],o={getDropInfo:function(){},move:function(t){var e,o,s,n;if(0!=i.length)for(var a,h=i.length-1;h>=0;h--){if(a=i[h],e=a.$drop.offset().left-this.$range.offset().left,o=a.$drop.offset().top-this.$range.offset().top,s=a.$drop.outerWidth(),n=a.$drop.outerHeight(),e<=t.x+this.dragParms.width/2&&o<=t.y+this.dragParms.height/2&&e+s>=t.x+this.dragParms.width/2&&o+n>=t.y+this.dragParms.height/2){a.isOver=!0,a.isOut=!1,(a.isOver&&!a.hasOverCallback||this.index!=h)&&(a.hasOverCallback=!0,this.index=h);break}a.isOver=!1,a.isOut=!0,a.hasOverCallback=!1}},out:function(){}},s=function(e){this.options=t.extend(!0,{$layer:null,$handle:null,$range:null,direction:"",resizable:!1,scale:!1,boundary:!1,minWidth:100,callback:{start:t.noop,move:t.noop,stop:t.noop,resize:t.noop}},e),this.$layer=e.$layer,this.$handle=e.$handle,this.$range=e.$range,this.$window=t(window),this.$document=t(document),this.isResize=!1,this.moving=!1,this.offset={x:0,y:0},this.originalCoord={x:0,y:0},this.resizeParams={left:0,top:0,width:0,height:0,type:"bottomRight"},this.init()};return s.prototype.init=function(){this.$layer&&(this.$range&&this.$range.css("position","relative"),this.$handle=this.$handle||this.$layer,this.$layer.css({cursor:"move",position:"absolute",zIndex:e}),this.options.resizable&&(this.$layer.append('<span class="k-resizable k-resizable-topLeft" data-type="topLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-topRight" data-type="topRight"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomLeft" data-type="bottomLeft"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomRight" data-type="bottomRight"></span>'),this.options.scale||(this.$layer.append('<span class="k-resizable k-resizable-topCenter" data-type="topCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-leftCenter" data-type="leftCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-rightCenter" data-type="rightCenter"></span>'),this.$layer.append('<span class="k-resizable k-resizable-bottomCenter" data-type="bottomCenter"></span>'))),this.setMinSize(),this.eventBind())},s.prototype.setMinSize=function(){var t,e=this.$layer.outerWidth(),i=this.$layer.outerHeight();this.minWidth=this.options.minWidth||e,e>=i?(t=e/i,this.minHeight=this.minWidth/t):(t=i/e,this.minHeight=this.minWidth*t)},s.prototype.eventBind=function(){var i=this;this.$handle.on("mousedown.dragdrop",function(t){e++,i.$layer.css("zIndex",e),i.dragParms={left:parseInt(i.$layer.position().left),top:parseInt(i.$layer.position().top),width:parseInt(i.$layer.outerWidth()),height:parseInt(i.$layer.outerHeight())},t.stopPropagation(),t.preventDefault(),i.start(t),document.onselectstart=function(){return!1}}).on("mousedown.dragdrop",".k-resizable",function(){i.isResize=!0,i.resizeParams.type=t(this).attr("data-type"),i.resizeParams.left=parseInt(i.$layer.position().left),i.resizeParams.top=parseInt(i.$layer.position().top),i.resizeParams.width=parseInt(i.$layer.outerWidth()),i.resizeParams.height=parseInt(i.$layer.outerHeight()),i.resizeParams.ratio=i.resizeParams.width>=i.resizeParams.height?i.resizeParams.width/i.resizeParams.height:i.resizeParams.height/i.resizeParams.width})},s.prototype.start=function(e){var i=this;this.$document.on("mousemove.dragdrop",function(t){i.isMoving&&(i.isResize?i.resize(t):i.move(t))}).on("mouseup.dragdrop",function(t){i.stop(t),i.$document.off("mousemove.dragdrop"),i.$document.off("mouseup.dragdrop")});var o=this.getMouseCoord(e);return this.offset.x=o.x-this.$layer.position().left,this.offset.y=o.y-this.$layer.position().top,this.originalCoord.x=o.x,this.originalCoord.y=o.y,this.$handle[0].setCapture&&this.$handle[0].setCapture(),this.isMoving=!0,t.isFunction(this.options.callback.start)&&this.options.callback.start(e,this.$layer),!1},s.prototype.move=function(e){var i,s,n=this.getMouseCoord(e),a={x:n.x-this.offset.x,y:n.y-this.offset.y},h=this.$range;h?(i=h.width()-this.$layer.outerWidth(!0),s=h.height()-this.$layer.outerHeight(!0),this.options.boundary||(a.x<0&&(a.x=0),a.y<0&&(a.y=0),a.x>i&&(a.x=i),a.y>s&&(a.y=s))):(i=this.$window.width()-this.$layer.outerWidth()+this.$document.scrollLeft(),s=this.$window.height()-this.$layer.outerHeight()+this.$document.scrollTop(),a.x<0&&(a.x=0),a.y<0&&(a.y=0),a.x>i&&(a.x=i),a.y>s&&(a.y=s)),this.setPosition(a),o.move.call(this,a),t.isFunction(this.options.callback.move)&&this.options.callback.move.call(this,a)},s.prototype.resize=function(e){var i,o,s=this.getMouseCoord(e),n={x:s.x-this.offset.x,y:s.y-this.offset.y},a=(this.$layer,this.resizeParams),h={left:0,top:0,width:0,height:0},r=this.$range;switch(r?(i=r.width(),o=r.height()):(i=this.$window.width()+this.$document.scrollLeft(),o=this.$window.height()+this.$document.scrollTop()),this.resizeParams.type){case"topLeft":h.width=a.width+(a.left-n.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.top=a.top-(h.height-a.height),h.left=a.left-(h.width-a.width),h.left<0&&(h.left=0,h.width=a.width+a.left,h.height=this.getScaleHeight(h.width),h.top=a.top-(h.height-a.height)),h.top<0&&(h.top=0,h.height=a.height+a.top,h.width=this.getScaleWidth(h.height),h.left=a.left-(h.width-a.width));break;case"topRight":h.left=a.left,h.width=a.width-(this.originalCoord.x-s.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.width+h.left>=i&&(h.width=i-a.left,h.height=this.getScaleHeight(h.width)),h.top=a.top-(h.height-a.height),h.top<0&&(h.top=0,h.height=a.height+a.top,h.width=this.getScaleWidth(h.height));break;case"leftCenter":h.top=a.top,h.height=a.height,n.x<=0?(h.left=0,h.width=a.width+a.left):(h.left=n.x,h.width=a.width+(this.originalCoord.x-s.x)),h.width<=this.minWidth&&(h.width=this.minWidth,h.left=a.left+(a.width-h.width));break;case"rightCenter":h.top=a.top,h.left=a.left,h.height=a.height,h.width=a.width-(this.originalCoord.x-s.x),h.width+h.left>=i&&(h.width=i-a.left),h.width<=this.minWidth&&(h.width=this.minWidth);break;case"topCenter":h.top=n.y,h.left=a.left,h.width=a.width,h.height=a.height+(this.originalCoord.y-s.y),n.y<0&&(h.top=0,h.height=a.height+a.top),h.height<=this.minHeight&&(h.height=this.minHeight,h.top=a.top+(a.height-h.height));break;case"bottomCenter":h.top=a.top,h.left=a.left,h.width=a.width,h.height=a.height-(this.originalCoord.y-s.y),h.height+h.top>=o&&(h.height=o-a.top),h.height<=this.minHeight&&(h.height=this.minHeight);break;case"bottomLeft":h.top=a.top,h.width=a.width+(this.originalCoord.x-s.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.left=a.left-(h.width-a.width),h.left<=0&&(h.left=0,h.width=a.width+a.left,h.height=this.getScaleHeight(h.width)),h.height+h.top>=o&&(h.height=o-h.top,h.width=this.getScaleWidth(h.height),h.left=a.left-(h.width-a.width));break;case"bottomRight":h.top=a.top,h.left=a.left,h.width=a.width-(this.originalCoord.x-s.x),h.width=h.width<this.minWidth?this.minWidth:h.width,h.height=this.getScaleHeight(h.width),h.width+h.left>=i&&(h.width=i-a.left,h.height=this.getScaleHeight(h.width)),h.top+h.height>=o&&(h.height=o-h.top,h.width=this.getScaleWidth(h.height))}this.$layer.css(h),t.isFunction(this.options.callback.resize)&&this.options.callback.resize(h)},s.prototype.getScaleWidth=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t*e:t/e},s.prototype.getScaleHeight=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t/e:t*e},s.prototype.stop=function(e){this.isMoving=!1,this.isResize=!1,this.$handle[0].releaseCapture&&this.$handle[0].releaseCapture(),t.isFunction(this.options.callback.stop)&&this.options.callback.stop(e,this.$layer)},s.prototype.getMouseCoord=function(t){return{x:t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop}},s.prototype.setPosition=function(t){"h"===this.options.direction?this.$layer.css("left",t.x):"v"===this.options.direction?this.$layer.css("top",t.y):this.$layer.css({left:t.x,top:t.y})},s.draggable=function(e){e=e||t("[data-module=draggable]")},s.droppable=function(e){e=e||t("[data-module=droppable]"),e.each(function(){t(this)})},s}),define("km/dropDownTree",["jquery","km/tree"],function($,Tree){var DropDownTree=function(t,e){this.$elm=t,this.options=$.extend(!0,{data:[],url:null,width:null,height:200,zIndex:999,appendTo:$(document.body),isTree:!0,multiple:!1,inputGroup:".k-input-group",bindElement:null,callback:{select:$.noop,check:$.noop,hide:$.noop}},e),this.$treePanel=$('<div class="k-dropDownTree k-pop-panel"></div>'),this.init()};return DropDownTree.prototype.init=function(){var self=this;(this.options.url&&0!=this.options.url.length||this.options.data&&0!=this.options.data.length)&&(this.options.bindElement=$(this.options.bindElement),this.$inputGroup=this.$elm.parent(this.options.inputGroup),this.$elm.attr("readonly","readonly"),this.elmWidth=this.$elm.outerWidth(),this.$treePanel.css({width:this.options.width||this.$inputGroup.outerWidth()||this.elmWidth,height:this.options.height,zIndex:this.options.zIndex}).appendTo(this.options.appendTo),this.options.isTree||(this.options.view={showLine:!1,showIcon:!1},this.$treePanel.addClass("k-dropDownTree-list")),this.options.multiple&&(this.options.check={enable:!0,chkType:"checkbox",chkBoxType:{Y:"",N:""}}),this.options.callback.onCheck=function(t){self.check(t)},this.options.callback.onSelect=function(t){self.select(t)},this.options.url?$.get(this.options.url,{rand:Math.random()},function(data){"string"==typeof data&&(data=eval("(0,"+data+")")),self.options.data=data,self.tree=new Tree(self.$treePanel,self.options),self.watch()}):(this.tree=new Tree(this.$treePanel,this.options),this.watch()))},DropDownTree.prototype.watch=function(){var t=this;this.$elm.on("click.dropDownTree",function(){return t.show(),!1}),this.$inputGroup.on("click.dropDownTree","button",function(){return t.show(),!1}),$(document).on("click.dropDownTree",function(e){var i=$(e.target);i.hasClass("k-dropDownTree")||i.parents(".k-dropDownTree").length>0||t.hide()}),$(window).on("resize.dropDownTree",function(){t.setPosition()})},DropDownTree.prototype.select=function(t){return this.options.multiple?void this.tree.$tree.find("a.selected").removeClass("selected"):(this.options.bindElement&&this.options.bindElement.val(t.value||t.nodeId||t.text),this.$elm.val(t.text).attr("title",t.text).focus().blur(),void this.options.callback.select(t))},DropDownTree.prototype.check=function(){for(var t=this.tree.getCheckedNodes(),e=[],i=[],o=0;o<t.length;o++)i.push(t[o].text),e.push(t[o].value||t[o].nodeId||t[o].text);this.options.bindElement&&this.options.bindElement.val(e.join(",")),this.$elm.val(i.join(",")).attr("title",i.join(",")).focus().blur(),this.options.callback.check(t)},DropDownTree.prototype.setPosition=function(){this.$treePanel.css({left:this.$elm.offset().left,top:this.$elm.offset().top+this.$elm.outerHeight()+2})},DropDownTree.prototype.show=function(){"block"!=this.$treePanel[0].style.display&&($("div.k-pop-panel").hide(),this.$treePanel.slideDown(),this.setPosition())},DropDownTree.prototype.hide=function(){"block"==this.$treePanel[0].style.display&&this.options.callback.hide(),this.$treePanel.slideUp()},DropDownTree.Global=function($elms){$elms=$elms||$("input[data-module=dropdowntree]"),$elms.each(function(){var $elm=$(this),options=$elm.attr("data-options"),url=$elm.attr("data-url"),width=$elm.attr("data-width"),height=$elm.attr("data-height"),zIndex=$elm.attr("data-zIndex"),appendTo=$elm.attr("data-appendTo"),isTree=$elm.attr("data-isTree")||!0,multiple=$elm.attr("data-multiple")||!1,array=$elm.attr("data-data"),callback=$elm.attr("data-callback"),bindElm=$elm.attr("data-bindelement")||null,data;data=$elm.data("dropDownTree"),options=options&&options.length>0?eval("(0,"+options+")"):{data:eval(array),url:url,width:width&&width.length>0?parseInt(width):null,height:height&&height.length>0?parseInt(height):200,zIndex:zIndex&&zIndex.length>0?parseInt(zIndex):999,appendTo:$(appendTo||document.body),isTree:isTree&&"false"==isTree?!1:!0,multiple:multiple&&"true"==multiple?!0:!1,bindElement:bindElm,callback:callback&&callback.length>0?eval("(0,"+callback+")"):{}},data||(data=new DropDownTree($elm,options),$elm.data("dropDownTree",data))})},DropDownTree}),define("km/dropdown",["jquery"],function(t){var e=t("body"),i=t(document),o=0,s=function(e,i){this.$soure=e,this.setting=t.extend({width:e.width(),height:e.height()},i||{}),e.data("widget",this),o++,this.id=o,this.nameSpace="dropdown_"+String(this.id),this.initDom()};return s.prototype.initDom=function(){var e=this.$soure.parent();this.$soure.css({visibility:"hidden"}),"static"===e.css("position")&&e.css({visibility:"relative"});var i=1;"auto"===this.$soure.css("zIndex")?this.$soure.css("zIndex",1):i=Number(this.$soure.css("zIndex")),this.$el=t('<div class="widget-dropbox"/>').css({width:this.setting.width,height:this.setting.height,zIndex:i+1}),this.$label=t('<div class="label"/>').css({width:this.setting.width-this.setting.height,height:this.setting.height,lineHeight:String(this.setting.height-4)+"px"}).appendTo(this.$el),this.$icon=t('<div class="ic">&#9660;</div>').css({width:this.setting.height,height:this.setting.height,lineHeight:String(this.setting.height)+"px"}).appendTo(this.$el),this.buildDrop(),this.$el.insertBefore(this.$soure),this.watch()},s.prototype.syncPosition=function(){this.$el.css(this.$soure.position())},s.prototype.setLabel=function(t){this.$label.text(t).attr("title",t)},s.prototype.getVal=function(){return this.$soure.val()},s.prototype.setVal=function(t){this.$soure.val(t).change()},s.prototype.buildDrop=function(){this.$drop&&this.$drop.remove(),this.$drop=t('<div class="widget-dropbox-drop"/>').css({width:this.setting.width}).hide();var i=[];this.$soure.find("option").each(function(){var e=t(this);i.push('<li data-val="'+e.val()+'">'+e.text()+"</li>")});var o=t("<ul>"+i.join("")+"</ul>");o.appendTo(this.$drop),this.$drop.appendTo(e),this.syncPosition(),this.sync()},s.prototype.sync=function(){var t=this.$soure.find("option:selected").text();if(!t){var e=this.$soure.find("option").eq(0);t=e.text(),this.setVal(e.val())}this.setLabel(t)},s.prototype.showDrop=function(){var e=this,o=e.$el.offset();e.$el.addClass("widget-dropbox-hover"),e.$drop.css({top:o.top+e.setting.height+2,left:o.left}).show(),i.on("click."+e.nameSpace,function(i){i.target!==e.$label[0]&&i.target!==e.$icon[0]&&i.target!==e.$drop[0]&&!1===t.contains(e.$drop[0],i.target)&&e.hideDrop()})},s.prototype.hideDrop=function(){var t=this;t.$drop.hide(),t.$el.removeClass("widget-dropbox-hover"),i.off("click."+t.nameSpace)},s.prototype.watch=function(){var e=this;this.$el.on("click",function(){e.showDrop()}),this.$drop.on("click","li",function(){var i=t(this);return e.setVal(i.data("val")),e.sync(),e.hideDrop(),!1})},s.prototype.reload=function(){this.buildDrop()},s}),define("km/dropdownDatepicker",["jquery","km/dropdown","km/datePicker","km/util"],function(t,e,i,o){var s=function(t,i){e.call(this,t,i)};return s.prototype=o.createProto(e.prototype),s.prototype.buildDrop=function(){var t=this;this.datepicker=new i(t.$el,{format:this.setting.format,showTime:this.setting.showTime||!1}),this.datepicker.on("selected",function(e){t.$el.data("value",e),t.setVal(e),t.setLabel(e)}).on("clean",function(){var e=t.$soure.attr("placeholder")||"选择日期";t.setVal(""),t.setLabel(e),t.$el.data("value",null)}),t.sync()},s.prototype.sync=function(){var t=this.getVal();if(t)this.$el.data("value",t),this.setVal(t),this.setLabel(t);else{var e=this.$soure.attr("placeholder")||"选择日期";this.setLabel(e)}},s.prototype.watch=function(){},s}),define("km/event",[],function(){var t={},e={},i=-1;return t.on=function(t,o){e[t]||(e[t]=[]);var s=(++i).toString();return e[t].push({token:s,func:o}),s},t.off=function(t){if(!t)return i=-1,void(e={});if(/^\d+$/.test(t)){for(var o in e)if(e[o])for(var s=0,n=e[o].length;n>s;s++)if(e[o][s].token===t)return e[o].splice(s,1),t}else e[t]&&delete e[t]},t.trigger=function(t,i){if(!e[t])return!1;for(var o=e[t],s=o?o.length:0;s--;)o[s].func(i)},t}),define("km/focusMap",["jquery"],function(t){var e=function(e,i){this.$el=e,this.options=t.extend(!0,{containerWidth:null,width:600,height:300,delay:3e3},i),this.tm=null,this.isStop=!1,this.index=0,this.init()};return e.prototype.init=function(){this.winWidth=t(window).width(),this.winWidth<this.options.width&&(this.options.width=this.winWidth,this.options.height="auto"),this.$el.css({width:this.options.containerWidth||this.options.width,height:this.options.height}),this.$ul=this.$el.find("ul"),this.$lis=this.$ul.find("li"),1!=this.$lis.length&&(this.$ul.append(this.$lis.eq(0).clone(!0)),this.$ul.prepend(this.$lis.eq(this.$lis.length-1).clone(!0)),this.$lis=this.$ul.find("li").width(this.options.width),this.total=this.$lis.length,this.max=this.total-2,this.$ul.width(this.total*this.options.width).css("marginLeft",-(this.index+1)*this.options.width),this.create(),this.watch(),this.max>1&&(this.$el.append('<div class="k-focusmap-prev"><</div><div class="k-focusmap-next">></div>'),this.run()))},e.prototype.create=function(){var t=[],e=16*this.max/2;t.push('<div class="k-focusmap-dot" style="margin-left:-'+e+'px;">');for(var i=0;i<this.max;i++)t.push('<span class="'+(0==i?"current":"")+'"></span>');t.push("</div>"),this.$el.append(t.join("")),this.$dots=this.$el.find(".k-focusmap-dot span")},e.prototype.watch=function(){var e=this;this.isWatch||(this.isWatch=!0,this.$el.on("mouseenter.focusmap",function(){e.stop()}).on("mouseleave.focusmap",function(){e.run()}).on("click.focusmap",".k-focusmap-prev",function(){e.index--,e.active()}).on("click.focusmap",".k-focusmap-next",function(){e.index++,e.active()}).on("click.focusmap","span",function(){var i=t(this),o=i.index();e.index=o,e.active()}))},e.prototype.run=function(){var t=this;this.isStop=!1,this.tm=setTimeout(function(){t.index++,t.active(function(){t.isStop||t.run()})},this.options.delay)},e.prototype.stop=function(){this.tm&&(clearTimeout(this.tm),this.isStop=!0)},e.prototype.active=function(t){var e=this,i=this.index+1;this.index==this.max&&(this.index=0),this.index<0&&(this.index=this.max-1),this.$ul.stop().animate({marginLeft:-i*this.options.width},function(){i==e.total-1&&e.$ul.css("marginLeft",-1*e.options.width),0==i&&e.$ul.css("marginLeft",-e.max*e.options.width),e.$dots.removeClass("current").eq(e.index).addClass("current"),"function"==typeof t&&t()})},function(t,i){var o=new e(t,i);return o}}),define("km/highlight",["jquery"],function(t){var e={},i=t(document.body),o="k-highlight";return e.highlightHtml=function(t,e,o){"object"!=typeof t&&(o=e,e=t,t=i);var s=this.highlightText(t.html(),e,o);t.html(s)},e.highlightText=function(e,i,s){if(!e||0===e.length)return"";if(e=this.highlightClean(e,s),s=s||o,!i)return e;if(t.isArray(i)||(i=[i]),1===i.length&&0===t.trim(i[0]).length)return e;for(var n=e.match(/[^<>]+|<(\/?)([A-Za-z]+)([^<>]*)>/g),a=0;a<n.length;a++)/<[^>]+>/.test(n[a])||0==t.trim(n[a]).length||(n[a]=n[a].replace(new RegExp("("+i.join("|")+")","ig"),'<span class="'+s+'">$1</span>'));return n.join("")},e.highlightClean=function(t,e){e=e||o;var i=new RegExp('<span class="?'+e+'"?>(.*?)</span>',"ig");return t=t.replace(i,"$1")},e}),define("km/imgPreview",["jquery","km/loading","km/popTips"],function(t,e,i){var o=function(e,i){this.$elements=e,this.options=t.extend(!0,{delay:500,showButtons:!0,backdrop:!0,backdropClose:!0,tpl:'<div class="k-imgPreview"><div class="k-container"><span class="close" role="close"><i class="fa fa-close"></i></span><span class="prev" role="prev"><i class="fa fa-chevron-left"></i></span><span class="next" role="next"><i class="fa fa-chevron-right"></i></span><img src="" /></div><p class="description"></p></div>'},i),this.$win=t(window),this.isLoading=!1,this.index=0,this.init()};return o.prototype.init=function(){0!==this.$elements.length&&(this.$imgPreview=t(this.options.tpl).appendTo(document.body),this.$container=this.$imgPreview.find(".k-container"),this.$img=this.$container.find("img"),this.$prev=this.$container.find(".prev"),this.$next=this.$container.find(".next"),this.$backdrop=t("<div/>").addClass("k-imgPreview-backdrop").appendTo(document.body),this.$elements.css("cursor","pointer").each(function(e){var i=t(this),o="imgPreview_"+e;this.id=o,i.attr("data-index",e)}),this.eventBind())},o.prototype.eventBind=function(){var e=this;this.$elements.on("click.imgpreview",function(){var i=t(this);e.index=Number(i.attr("data-index")),e.show()}),this.$backdrop.on("click.imgpreview",function(){e.options.backdropClose&&e.hide()}),this.$imgPreview.on("click.imgpreview","[role=close]",function(){e.hide()}).on("click.imgpreview","[role=prev]",function(){e.isLoading||0!==e.index&&(e.index--,e.showControls(),e.show())}).on("click.imgpreview","[role=next]",function(){e.isLoading||e.index>=e.$elements.length-1||(e.index++,e.showControls(),e.show())}).on("mouseenter.imgpreview",function(){e.showControls()}).on("mouseleave.imgpreview",function(){e.$prev.hide(),e.$next.hide()}),this.$win.on("resize.imgpreview",function(){var t=e.$img.attr("data-width"),i=e.$img.attr("data-height");e.setPosition({width:t,height:i})})},o.prototype.showControls=function(){var t=this.$elements.length;1!==t&&(0===this.index?(this.$prev.hide(),this.$next.show()):this.index>=t-1?(this.$prev.show(),this.$next.hide()):(this.$prev.show(),this.$next.show()))},o.prototype.imgLoad=function(t,e){var o=new Image;o.onload=function(){e(!0,{width:o.width,height:o.height})},o.onerror=function(){i.error("图片加载失败！",1500),e(!1,{width:0,height:0})},o.src=t},o.prototype.getMaxSize=function(){return{width:this.$win.width()-100,height:this.$win.height()-100}},o.prototype.zoom=function(t,e){var i,o,s=this.getMaxSize();return t<s.width&&e<s.height?{width:t,height:e}:(t>=e?(i=t/e,o=s.width/i):(i=e/t,o=s.width*i),nw=s.width,o>s.height&&(o=s.height,nw=t/e*o),{width:nw,height:o})},o.prototype.show=function(){var t,i=this,o=this.$elements.eq(this.index);0!==o.length&&(t=o.attr("data-href")||o.attr("src"),t&&!this.isLoading&&(this.isLoading=!0,e.show(),this.imgLoad(t,function(o,s){o?(i.$img.attr({src:t,"data-width":s.width,"data-height":s.height}),i.setPosition(s),i.$imgPreview.hide().fadeIn(i.options.delay),i.options.backdrop&&"block"!=i.$backdrop[0].style.display&&i.$backdrop.css({opacity:0,display:"block"}).animate({opacity:.8},i.options.delay)):i.hide(),e.hide(),i.isLoading=!1})))},o.prototype.hide=function(){this.isLoading=!1,e.hide(),this.$imgPreview.fadeOut(this.options.delay),this.options.backdrop&&this.$backdrop.fadeOut(this.options.delay)},o.prototype.setPosition=function(t){var e=(this.$win.width(),this.$win.height(),t.width),i=t.height,o=this.zoom(e,i);this.$container.css({width:o.width,height:o.height}),this.$imgPreview.css({width:o.width+20,height:o.height+20,marginTop:-((o.height+20)/2),marginLeft:-((o.width+20)/2)})},function(e,i){e=e||t("img");var s=new o(e,i);return s}}),define("km/infiniteScroll",["jquery"],function(t){var e=function(e){var i=this;this.options=t.extend(!0,{$scrollElement:t(window),$watchElement:null,scrollDistance:.3,callback:t.noop},e),this.$scrollElement=this.options.$scrollElement,this.$watchElement=this.options.$watchElement,this.$watchElement&&(this.top=this.$watchElement.position().top,this.$scrollElement.on("scroll.infiniteScroll",function(){i.scroll()}),this.scroll())};return e.prototype.scroll=function(){var t=this.$scrollElement.height(),e=t+this.$scrollElement.scrollTop(),i=this.top+this.$watchElement.height(),o=i-e,s=o<=t*this.options.scrollDistance;s&&this.options.callback()===!1&&this.destroy()},e.prototype.destroy=function(){this.$scrollElement.off("scroll.infiniteScroll")},e}),define("km/layout",["jquery","km/panel","km/cache"],function($,Panel,cache){var Layout=function(t,e){this.$layout=t,this.options=$.extend(!0,{cache:!1,resizeMin:5,panel:{left:{width:100},top:{height:100},right:{width:100},bottom:{height:100}}},e),this.$parent=this.$layout.parent(),this.init(),this._event={show:$.noop,hide:$.noop}};return Layout.prototype.init=function(){var t=this;this.$win=$(window),this.$panels=this.$layout.children(".k-panel"),this.$leftPanel=this.$panels.filter(".k-panel-left"),this.$topPanel=this.$panels.filter(".k-panel-top"),this.$rightPanel=this.$panels.filter(".k-panel-right"),this.$bottomPanel=this.$panels.filter(".k-panel-bottom"),this.$centerPanel=this.$panels.filter(".k-panel-center"),this.$panels.each(function(){var e=$(this),i=e.attr("data-type"),o=$(t.getExpandHtml(i)).appendTo(t.$layout);e.data("expand",o)}),this.setSize(),this.panelInit(),this.watch()},Layout.prototype.panelInit=function(){var t=this;this.$panels.each(function(){var e=$(this).show(),i=e.attr("data-type"),o=t.options.resizeMin,s={resizable:{enabled:!0,cover:!0,border:{left:!1,top:!1,right:!1,bottom:!1},callback:{stop:function(){t.$centerPanel.length>0?t.$centerPanel.resize():t.setSize()}}},width:e.width(),height:e.height()};switch(i){case"top":s.minHeight=o,s.resizable.border.bottom=!0;break;case"left":s.minWidth=o,s.resizable.border.right=!0;break;case"right":s.minWidth=o,s.resizable.border.left=!0;break;case"bottom":s.minHeight=o,s.resizable.border.top=!0}var n=new Panel(e,s);e.data("panel",n)})},Layout.prototype.watch=function(){var t=this;this.$win.on("resize.layout",function(){t.setSize()}),this.$panels.on("click.layout","span[role=hide]",function(){return t.hide($(this).attr("data-type")),!1}),this.$layout.on("click.layout","span[role=show]",function(){return t.show($(this).attr("data-type")),!1})},Layout.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Layout.prototype.show=function(t){var e,i=this,o=this.getPanelsInfo(),s=o[t],n=s.$panel.attr("data-isHide",!1),a=s.$expand;switch(a.hide(),n.show(),t){case"top":e={top:0};break;case"left":e={left:0};break;case"right":e={right:0};break;case"bottom":e={bottom:0}}n.stop().animate(e,function(){i.setSize(),i.$centerPanel&&i.$centerPanel.resize()}),this._event.show.call(this,s)},Layout.prototype.hide=function(t){var e,i=this,o=this.getPanelsInfo(),s=o[t];switch(s.$panel.attr("data-isHide",!0),i.setSize(),i.$centerPanel&&i.$centerPanel.resize(),t){case"top":e={top:-s.height};break;case"left":e={left:-s.width};break;case"right":e={right:-s.width},s.$panel.css("right",0);break;case"bottom":e={bottom:-s.height},s.$panel.css("bottom",0)}s.$panel.stop().animate(e,function(){s.$panel.hide(),s.$expand.show(),i._event.hide.call(i,s)})},Layout.prototype.getExpandHtml=function(t){var e="",i="";switch(t){case"left":e="panel-expand panel-expand-left",i="fa fa-angle-double-right";break;case"top":e="panel-expand panel-expand-top",i="fa fa-angle-double-down";break;case"right":e="panel-expand panel-expand-right",i="fa fa-angle-double-left";break;case"bottom":e="panel-expand panel-expand-bottom",i="fa fa-angle-double-up"}return'<div class="'+e+'"><span class="'+i+'" role="show" data-type="'+t+'"></span></div>'},Layout.prototype.setSize=function(){var t=this.$parent,e=t.width(),i=t.height(),o=this.getPanelsInfo(),s=0,n=0,a=0,h=0;"body"==t[0].tagName.toLowerCase()&&(t.addClass("k-layout-body"),i=this.$win.height()),this.$layout.css({width:e,height:i}),o.top&&(o.top.$panel.css({height:o.top.height,width:"100%"}),o.top.setBodyHeight(),h+=o.top.isHide?o.top.expandHeight:o.top.height),s+=h,o.bottom&&(o.bottom.$panel.css({height:o.bottom.height,width:"100%",top:"none"}),o.bottom.setBodyHeight(),o.bottom.isHide?(o.bottom.$panel.css("bottom",-o.bottom.height),h+=o.bottom.expandHeight):(o.bottom.$panel.css("bottom",0),h+=o.bottom.height)),h=i-h,o.left&&(o.left.$panel.css({width:o.left.width,top:s,height:h}),o.left.setBodyHeight(),o.left.$expand.css({top:s,height:h}),o.left.isHide?(a+=o.left.expandWidth,n+=a):(a+=o.left.width,n+=a)),o.right&&(o.right.$panel.css({width:o.right.width,top:s,height:h,left:"none"}),o.right.setBodyHeight(),o.right.$expand.css({top:s,height:h}),o.right.isHide?(o.right.$panel.css("right",-o.right.width),a+=o.right.expandWidth):(o.right.$panel.css("right",0),a+=o.right.width)),o.center&&(a=e-a,o.center.$panel.css({top:s,left:n,width:a,height:h}),o.center.setBodyHeight())},Layout.prototype.getPanelsInfo=function(t){var e={};return this.$panels.each(function(){var t=$(this),i=t.data("expand"),o=t.data("panel"),s=t.attr("data-type");e[s]={left:t.position().left,top:t.position().top,width:t.outerWidth(),height:t.outerHeight(),isHide:"true"==t.attr("data-ishide"),$panel:t,$expand:i,panel:o,expandWidth:i.outerWidth(),expandHeight:i.outerHeight(),setBodyHeight:function(){o&&o.setBodyHeight()}}}),t?e[t]:e},Layout.Global=function($elms){$elms=$elms||$("div[data-module=layout]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onShow=$el.attr("data-onshow"),onHide=$el.attr("data-onhide"),data=$el.data("layout");options&&options.length>0&&(options=eval("(0,"+options+")")),onShow=onShow&&onShow.length>0?eval("(0,"+onShow+")"):$.noop,onHide=onHide&&onHide.length>0?eval("(0,"+onHide+")"):$.noop,data||(data=new Layout($el,options),data.on("show",function(t){onShow.call(this,t)}).on("hide",function(t){onHide.call(this,t)}),$el.data("layout",data))})},Layout}),define("km/lazyload",["jquery"],function(t){function e(e,i){this.$elements=e,this.options=t.extend(!0,{placeholder:null,$container:t(window),callback:t.noop},i),this.cache=[],this.init()}return e.prototype.init=function(){var e=this;this.$elements.each(function(){if("img"==this.nodeName.toLowerCase()&&"true"!=this.getAttribute("hasLoad")){var i=t(this),o={};null!=e.options.placeholder&&(this.setAttribute("data-url",this.src),this.src=e.options.placeholder),this.getAttribute("data-url")&&(o.$elm=i,o.url=this.getAttribute("data-url"),e.cache.push(o))
}}),0!==this.cache.length&&(this.count=this.cache.length,this.eventBind(),this.load())},e.prototype.eventBind=function(){this.options.$container.on("scroll.lazyload",t.proxy(this.load,this))},e.prototype.load=function(){var e=this,i=this.getPosition();this.count<=0||t.each(this.cache,function(t,o){{var s,n,a=o.$elm,h=o.url;o.tag}a&&(n=a.offset().top,s=[n-i.top,n-i.top+a.height()],(s[0]>=0&&s[0]<i.height||s[1]>0&&s[1]<=i.height)&&(!function(t,i){e.imgLoad(t,i,function(){t.hide().fadeIn(),e.callback(t)})}(a,h),o.$elm=null,e.count--))})},e.prototype.imgLoad=function(t,e,i){var o=new Image;o.onload=function(){t.attr("src",e),t.attr("hasLoad",!0),i()},o.onerror=function(){i()},o.src=e},e.prototype.getPosition=function(){var t,e={},i=this.options.$container,o=i.height();return t=i[0]===window?i.scrollTop():i.offset().top,e.height=o,e.top=t,e},e.prototype.callback=function(e){t.isFunction(this.options.callback)&&this.options.callback(e)},function(i,o){return i=i||t("img"),new e(i,o)}}),define("km/loading",["jquery","spin"],function(t,e){var i,o=function(e){this.options=t.extend(!0,{lines:12,length:10,width:4,radius:14,corners:1,rotate:0,direction:1,color:"white",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"k-spinner",zIndex:2e9,top:"70px",left:"70px"},e),this.tpl='<div class="k-loading"></div>',this.init()},s=!1;return o.prototype.init=function(){this.$loading=t(this.tpl).appendTo(document.body).hide(),this.options.top=this.$loading.outerHeight()/2+"px",this.options.left=this.$loading.outerWidth()/2+"px",this.spinner=new e(this.options)},o.prototype.show=function(){s||(s=!0,this.spinner.spin(this.$loading.get(0)),this.$loading.fadeIn("fast"))},o.prototype.hide=function(){this.$loading.stop().hide(),this.spinner.stop(),s=!1},o.show=function(){i||(i=new o),i.show()},o.hide=function(){i&&i.hide()},o}),define("km/magnifier",["jquery"],function(t){var e=function(e,i){this.options=t.extend(!0,{offset:10,width:400,height:250,zoomWidth:400,zoomHeight:400,zIndex:100},i),this.$el=e,this._isLoading=!1,this.init()};return e.prototype.init=function(){this.create(),this.watch()},e.prototype.watch=function(){var t=this;this.$el.on("mousemove.magnifier",function(e){var i=t.$img.attr("data-big-img");if(t.$view.show(),"true"==t.$viewImg.attr("data-isLoad"))t.$selector.show(),t.setPosition(e);else{if(t.$viewImg.hide(),t._isLoading)return;t._isLoading=!0,t.loadImg(i,function(e,o){t.$viewLoading.hide(),t._isLoading=!1,t.$viewImg.attr({src:i,"data-isLoad":!0}).show(),t.$selector.width(t.options.zoomWidth/(o.width/t.options.width)).height(t.options.zoomHeight/(o.height/t.options.height))})}}).on("mouseleave.magnifier",function(){t.$view.hide(),t.$selector.hide()})},e.prototype.create=function(){this.$el.width(this.options.width).height(this.options.height),this.$imgBox=this.$el.find(".k-magnifier-imgbox").css({width:this.options.width,height:this.options.height}),this.$img=this.$el.find(".k-magnifier-imgbox img"),this.$view=t('<div class="k-magnifier-view"><img src="" /><div class="k-magnifier-loading"><span class="fa fa-spinner fa-spin"></span><br/>图片加载中，请稍候...</div></div>').appendTo(this.$el).css({width:this.options.zoomWidth,height:this.options.zoomHeight,left:this.$imgBox.position().left+this.options.width+this.options.offset,top:this.$imgBox.position().top,zIndex:this.options.zIndex}),this.$viewLoading=this.$view.find(".k-magnifier-loading"),this.$viewImg=this.$view.find("img"),this.$selector=t('<div class="k-magnifier-selector"></div>').appendTo(this.$imgBox).css({left:0,top:0})},e.prototype.loadImg=function(t,e){var i=new Image;i.onload=function(){e(!0,{width:i.width,height:i.height})},i.onerror=function(){e(!1,{width:0,height:0})},i.src=t},e.prototype.setPosition=function(t){var e,i,o=t.pageX,s=t.pageY,n=o-this.$el.offset().left,a=s-this.$el.offset().top,h=this.$selector.outerWidth(),r=this.$selector.outerHeight(),l=this.options.width-h,d=this.options.height-r;n-=h/2,a-=r/2,0>n?n=0:n>l&&(n=l),0>a?a=0:a>d&&(a=d),e=n/(this.$el.width()-h),i=a/(this.$el.height()-r),this.$selector.css({left:n,top:a}),this.$viewImg.css({width:this.options.zoomWidth/h*this.options.width,height:this.options.zoomHeight/r*this.options.height,left:-e*(this.$viewImg.width()-this.$view.width()),top:-i*(this.$viewImg.height()-this.$view.height())})},function(t,i){var o=new e(t,i);return o}}),define("km/pager",["jquery","km/event"],function(t,e){var i=function(i,o){this.$element=i,this.options=t.extend(!0,{curPage:1,totalCount:0,pageSize:20,className:"k-pagination"},o),this.canBuild=!0,this.curPage=this.options.curPage,this.totalCount=this.options.totalCount,this.pageSize=this.options.pageSize,this.template='<div class="pager-box"></div>',this.event=e,this.init()};return i.prototype.init=function(){var e=this;this.$pager=t(this.template).appendTo(this.$element),this.build(),this.$pager.on("click.pager","li",function(){var i=t(this),o=i.attr("data-page");i.hasClass("disabled")||i.hasClass("active")||(e.curPage=parseInt(o),e.event.trigger("click.pager",[o]),e.canBuild&&e.build())})},i.prototype.on=function(t,e){var i=this;this.event.on(t+".pager",function(t){e.apply(i,t)})},i.prototype.build=function(){var t,e=this.getInfo(),i=[];i.push('<ul class="'+this.options.className+'">'),t=this.curPage>1?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.pre+'" ><a href="javascript:void(0);"><<</a></li>');for(var o=e.start;o<=e.end;o++)t=o===this.curPage?"active":"",i.push('<li class="'+t+'" data-page="'+o+'" ><a href="javascript:void(0);">'+o+"</a></li>");t=this.curPage!==e.allPage?"":"disabled",i.push('<li class="'+t+'" data-page="'+e.next+'" ><a href="javascript:void(0);">>></a></li>'),i.push("</ul>"),this.$pager.html(i.join("")),0==this.totalCount?this.$pager.hide():this.$pager.show()},i.prototype.getInfo=function(){var t,e,i,o,s;return s=parseInt(this.totalCount/this.pageSize),s=this.totalCount%this.pageSize!==0?s+1:s,s=0===s?1:s,t=this.curPage+2>s?s-4:this.curPage-2,e=this.curPage<4?5:this.curPage+2,1>t&&(t=1),e>s&&(e=s),i=this.curPage-1<1?1:this.curPage-1,o=this.curPage+1>s?s:this.curPage+1,{start:t,end:e,pre:i,next:o,allPage:s}},i}),define("km/panel",["jquery","km/resizable"],function($,Resizable){var Panel=function(t,e){this.$panel=t,this.options=$.extend(!0,{width:"auto",height:"auto",minWidth:100,minHeight:100,resizable:{enabled:!1,cover:!1,border:{left:!0,top:!0,right:!0,bottom:!0},callback:{resize:$.noop,stop:$.noop}}},e),this.init()};return Panel.prototype.init=function(){this.$panel.css({width:this.options.width,height:this.options.height}),this.$header=this.$panel.find(".k-panel-head"),this.$title=this.$header.find(".k-panel-title"),this.$body=this.$panel.find(".k-panel-body"),this.$body.css("height",this.$panel.height()-this.$title.height()),this.headHeight=this.$header.outerHeight(),this.options.resizable.enabled&&(this.resizable=new Resizable(this.$panel,{border:this.options.resizable.border,cover:this.options.resizable.cover,minWidth:this.options.minWidth,minHeight:this.options.minHeight,$range:this.$panel.parent()})),this._event={slideDown:$.noop,slideUp:$.noop},this.watch()},Panel.prototype.watch=function(){var t=this;this.$panel.on("click.panel","span[role=slideup]",function(){t.slideUp($(this))}).on("click.panel","span[role=slidedown]",function(){t.slideDown($(this))}),this.resizable&&this.resizable.on("resize",function(e){t.setBodyHeight(e.height),t.options.resizable.callback.resize.call(t,e)}).on("stop",function(e){t.options.resizable.callback.stop.call(t,e)})},Panel.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Panel.prototype.setBodyHeight=function(t){t=t||this.$panel.height();var e=t-this.headHeight;this.$body.css("height",e)},Panel.prototype.setSize=function(t){this.$panel.css({width:t.width,height:t.height}),this.setBodyHeight(t.height)},Panel.prototype.slideDown=function(t){var e=this;return t.attr("role","slideup"),t.hasClass("fa-angle-double-down")?(t.removeClass("fa-angle-double-down").addClass("fa-angle-double-up"),this.$panel.stop().animate({height:this.orgHeight}),this.$body.stop().animate({height:this.orgHeight-this.headHeight,display:"block"},function(){e.resizable&&e.resizable.$bottomHandle.show()}),void this._event.slideDown.call(this)):void 0},Panel.prototype.slideUp=function(t){var e=this;return this.orgHeight=this.$panel.outerHeight(),t.attr("role","slidedown"),t.hasClass("fa-angle-double-up")?(t.removeClass("fa-angle-double-up").addClass("fa-angle-double-down"),this.$panel.stop().animate({height:this.headHeight}),this.$body.stop().animate({height:0},function(){e.$body.hide(),e.resizable&&e.resizable.$bottomHandle.hide()}),void this._event.slideUp.call(this)):void 0},Panel.Global=function($elms){$elms=$elms||$("div[data-module=panel]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onSlideDown=$el.attr("data-onslidedown"),onSlideUp=$el.attr("data-onslideup"),data=$el.data("panel");options&&options.length>0&&(options=eval("(0,"+options+")")),onSlideDown=onSlideDown&&onSlideDown.length>0?eval("(0,"+onSlideDown+")"):$.noop,onSlideUp=onSlideUp&&onSlideUp.length>0?eval("(0,"+onSlideUp+")"):$.noop,data||(data=new Panel($el,options),data.on("slideDown",function(){onSlideDown.call(this)}).on("slideUp",function(){onSlideUp.call(this)}),$el.data("panel",data))})},Panel}),define("km/placeholder",["jquery"],function(t){function e(e){e.each(function(){var e=t(this),o=e.data("placeholder");if(void 0===o){var s=t.trim(e.attr("placeholder"));if(!s||0===s.length)return;o=new i(e),e.data("placeholder",o)}else o.setPosition()})}var i=function(t){this.$elm=t,this.type="placeholder",this.init()};return i.prototype.init=function(){var e=t.trim(this.$elm.attr("placeholder"));this.timer=this.$elm.attr("data-timer"),this.timer&&(this.timer=JSON.stringify(this.timer)),this.$placeholder=t("<div/>").addClass("placeholder").text(e).insertAfter(this.$elm).hide(),this.$elm.parent().css("position","relative"),this.setPosition(),this.eventBind()},i.prototype.eventBind=function(){var e=this;this.timer&&setInterval(function(){e.setPosition()},this.timer.delay),this.$elm.on("focus."+this.type,function(){e.$placeholder.hide()}).on("blur."+this.type,function(){var i=t.trim(e.$elm.val());0===i.length||i===e.text?(e.$elm.val(""),e.$placeholder.show()):e.$placeholder.hide()}),this.$placeholder.on("focus."+this.type,function(){e.$elm.focus()})},i.prototype.display=function(){var e=t.trim(this.$elm.val());0===e.length||e===t.trim(this.$elm.attr("placeholder"))?this.$placeholder.show():this.$placeholder.hide()},i.prototype.setPosition=function(){var t=this;setTimeout(function(){var e={left:t.$elm[0].offsetLeft,top:t.$elm[0].offsetTop,height:t.$elm.outerHeight(),width:t.$elm.outerWidth(),position:"absolute",paddingLeft:"10px",paddingRight:"10px",paddingTop:0,margin:0,lineHeight:t.$elm.outerHeight()+"px",cursor:"text",color:"#999"};"textarea"===t.$elm[0].nodeName.toLowerCase()&&(e.lineHeight="auto",e.paddingTop=5),t.$placeholder.css(e),t.display()},50)},function(i){"placeholder"in document.createElement("input")||(i=i||t("input,textarea"),e(i))}}),define("km/popTips",["jquery"],function(t){var e=function(){function e(){function e(e,n,a,h){s&&clearTimeout(s),t.isFunction(a)&&(h=a,a=3e3),h=h||t.noop,a=a||3e3,o&&o.stop().remove(),o=t(i(e,n)).appendTo(document.body).hide(),o.css({marginLeft:-(o.width()/2),marginTop:-(o.height()/2)}).fadeIn("fase",function(){s=setTimeout(function(){o.stop().remove(),h()},a)})}function i(t,e){var i=[];switch(t){case"success":i.push('<div class="k-pop-tips success"><span class="fa fa-check"></span>&nbsp;<span>'+e+"</span></div>");break;case"error":i.push('<div class="k-pop-tips error"><span class="fa fa-close"></span>&nbsp;<span>'+e+"</span></div>");break;case"warning":i.push('<div class="k-pop-tips warning"><span class="fa fa-exclamation"></span>&nbsp;<span>'+e+"</span></div>")}return i.join("")}var o,s;return{success:function(t,i,o){e("success",t,i,o)},error:function(t,i,o){e("error",t,i,o)},warning:function(t,i,o){e("warning",t,i,o)}}}var i;return{getInstance:function(){return i||(i=e()),i}}}();return e.getInstance()}),define("km/popover",["jquery","km/tooltips","km/util"],function($,Tooltips,util){var Popover=function(t,e){e=$.extend(!0,{type:"popover",title:"标题",tpl:'<div class="k-popover"><div class="k-popover-arrow"></div><div class="k-popover-title"></div><div class="k-popover-inner"></div></div>'},e),Tooltips.call(this,t,e),this.setTitle()};return Popover.prototype=util.createProto(Tooltips.prototype),Popover.prototype.setTitle=function(t){t=$.trim(t||this.options.title),0===t.length&&(t=this.$element.attr("data-title")||"");var e=this.$tips;e.find(".k-popover-title").text(t)},Popover.prototype.setContent=function(t){t=$.trim(t||this.options.content),0===t.length&&(t=this.$element.attr("data-content")||"");var e=this.$tips;e.find(".k-popover-inner").html(t)},Popover.Global=function($elements){var $elements=$elements||$('[data-module="popover"]');$elements.each(function(){var $this=$(this),popover=Popover.Get($this);if(!popover){var options=$this.attr("data-options");options=options&&options.length>0?eval("(0,"+options+")"):{title:$this.attr("data-title"),content:$this.attr("data-content"),placement:$this.attr("data-placement"),tipClass:$this.attr("data-tipClass"),trigger:$this.attr("data-trigger")},popover=new Popover($this,options),Popover.Set($this,popover)}})},Popover.Get=function(t){return t.data("popover")},Popover.Set=function(t,e){t.data("popover",e)},Popover}),define("km/rating",["jquery","km/event"],function(t,e){var i={_createStar:function(){for(var e,o,s=[],n=1;n<=this.options.number;n++)o=i._getTitle.call(this,n),e=this.options.score&&this.options.score>=n?"starOn":"starOff",e=this.options.path+this.options[e],s.push('<img src="'+e+'" alt="'+n+'" title="'+o+'" style="padding-left:'+this.options.space+'px;" />');this.$stars=t(s.join("")).appendTo(this.$starBox)},_createScore:function(){this.options.scoreName&&this.options.score&&(this.$score=t("<input/>",{type:"hidden",name:this.options.scoreName,value:this.options.score}).appendTo(this.$el))},_getMin:function(t,e,i){return Math.min(Math.max(parseFloat(t),e),i)},_getTitle:function(t){var e=this.options.values[parseInt(t)-1];return""===e?"":e||t},_setStar:function(t){var e=(t-Math.floor(t)).toFixed(2);if(e>this.options.round.down){var i="starOn";this.options.half&&e<this.options.round.up?i="starHalf":e<this.options.round.full&&(i="starOff"),this.$stars.eq(Math.ceil(t)-1).attr("src",this.options.path+this.options[i])}},_fill:function(e){var i,o=this;this.$stars.each(function(s){i=e-1>=s?"starOn":"starOff",t(this).attr("src",o.options.path+o.options[i])})},_setScore:function(t){this.$score&&this.$score.val(t)},_setValue:function(t){this.$target&&"input"===this.$target[0].tagName.toLowerCase()&&this.$target.val(t)}},o=function(i,o){this.$el=i,this.options=t.extend(!0,{path:"../images/star",starOff:"star-off.png",starHalf:"star-half.png",starOn:"star-on.png",target:".k-rating-target",number:3,values:[1,2,3],score:0,scoreName:void 0,round:{down:.25,full:.6,up:.76},half:!0,size:24,space:4},o),this.event=e,this._tmpScore=0,this.init()};return o.prototype.init=function(){this.options.score=this.options.score<0?0:this.options.score,this._tmpScore=this.options.score,this.$starBox=this.$el.find(".k-rating-star"),this.$target=this.$el.find(this.options.target),this.options.path&&"/"!==this.options.path.slice(this.options.path.length-1,this.options.path.length)&&(this.options.path+="/"),i._createStar.call(this),i._createScore.call(this),i._setStar.call(this,this.options.score),this.watch()},o.prototype.watch=function(){var e=this;this.$el.on("mousemove.rating","img",function(o){var s,n=t(this),a=parseInt(n.attr("alt")),h=n.offset().left,r=o.pageX,l=(r-h)/e.options.size,d=l>.5?1:.5;e.options.half?(a=a-1+d,i._fill.call(e,a),i._setStar.call(e,a),i._setScore.call(e,a)):i._fill.call(e,a),s=i._getTitle.call(e,n.attr("alt")),e._tmpScore=a,i._setValue.call(e,s),e.event.trigger("mousemove.rating",[a,s])}).on("mouseleave.rating",".k-rating-star",function(){var o,s;e._tmpScore=e.options.score,e.$stars.each(function(i){o=e.options.score&&e.options.score-1>=i?"starOn":"starOff",t(this).attr("src",e.options.path+e.options[o])}),i._setStar.call(e,e.options.score),i._setScore.call(e,e.options.score),s=e.options.score>e.options.round.down?i._getTitle.call(e,Math.ceil(e.options.score)):"",i._setValue.call(e,s),e.event.trigger("mouseleave.rating",[e.options.score,s])}).on("click.rating","img",function(){var t;e.options.score=e._tmpScore,i._setStar.call(e,e.options.score),i._setScore.call(e,e.options.score),t=i._getTitle.call(e,Math.round(e.options.score)),i._setValue.call(e,t),e.event.trigger("click.rating",[e.options.score,t])})},o.prototype.on=function(t,e){var i=this;return this.event.on(t+".rating",function(t){e.apply(i,t)}),this},o}),define("km/resizable",["jquery"],function($){var $cover=$('<div class="k-resizable-cover"></div>').appendTo(document.body),Resizable=function(t,e){this.$elm=t,this.options=$.extend(!0,{$range:this.$elm.parent(),minBar:!1,scale:!1,cover:!0,minWidth:100,minHeight:100,border:{left:!0,top:!0,right:!0,bottom:!0}},e),this.originalCoord={x:0,y:0},this.offset={x:0,y:0},this.resizeParams={left:0,top:0,width:0,height:0,ratio:1,type:"bottom"},this.moving=!1,this.minWidth=this.options.minWidth,this.minHeight=this.options.minHeight,this._event={resize:$.noop,stop:$.noop},this.init()};return Resizable.prototype.init=function(){var t=[];t.push('<div class="k-resizable-handle k-resizable-handle-left" role="resizable" data-type="left"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-top" role="resizable" data-type="top"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-right" role="resizable" data-type="right"></div>'),t.push('<div class="k-resizable-handle k-resizable-handle-bottom" role="resizable" data-type="bottom"></div>'),t.push('<div class="k-resizable-handle-minbar" role="resizable" data-type="bottomRight"></div>'),this.$elm.addClass("k-resizable-container").append(t.join("")),this.$leftHandle=this.$elm.find(".k-resizable-handle-left"),this.$topHandle=this.$elm.find(".k-resizable-handle-top"),this.$rightHandle=this.$elm.find(".k-resizable-handle-right"),this.$bottomHandle=this.$elm.find(".k-resizable-handle-bottom"),this.$minbar=this.$elm.find(".k-resizable-handle-minbar"),this.$doc=$(document),this.$win=$(window),this.options.border.left&&this.$leftHandle.show(),this.options.border.top&&this.$topHandle.show(),this.options.border.right&&this.$rightHandle.show(),this.options.border.bottom&&this.$bottomHandle.show(),this.options.minBar&&this.$minbar.show(),this.watch()},Resizable.prototype.watch=function(){var t=this;this.$elm.on("mousedown.resizable","[role=resizable]",function(e){var i=$(this);t.resizeParams.top=parseInt(t.$elm.position().top),t.resizeParams.left=t.$elm.position().left,t.resizeParams.width=parseInt(t.$elm.outerWidth(!0)),t.resizeParams.height=parseInt(t.$elm.outerHeight(!0)),t.resizeParams.ratio=t.resizeParams.width>=t.resizeParams.height?t.resizeParams.width/t.resizeParams.height:t.resizeParams.height/t.resizeParams.width,t.resizeParams.type=i.attr("data-type"),t.showCover(),e.stopPropagation(),e.preventDefault(),t.start(e,i),document.onselectstart=function(){return!1}})},Resizable.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Resizable.prototype.start=function(t,e){var i=this;this.$doc.on("mousemove.resizable",function(t){i.resize(t)}).on("mouseup.resizable",function(t){i.stop(t,e),i.$doc.off("mousemove.resizable"),i.$doc.off("mouseup.resizable")});var o=this.getMouseCoord(t);this.offset.x=o.x-this.$elm.position().left,this.offset.y=o.y-this.$elm.position().top,this.originalCoord.x=o.x,this.originalCoord.y=o.y,this.moving=!0,e[0].setCapture&&e[0].setCapture(),this.css={left:this.resizeParams.left,top:this.resizeParams.top,width:this.resizeParams.width,height:this.resizeParams.height}},Resizable.prototype.resize=function(t){var e,i,o=this.getMouseCoord(t),s={x:parseInt(o.x-this.offset.x),y:parseInt(o.y-this.offset.y)},n={},a=this.resizeParams,h=this.options.$range;switch(h?(e=h.width(),i=h.height()):(e=this.$win.width()+this.$doc.scrollLeft(),i=this.$win.height()+this.$doc.scrollTop()),this.resizeParams.type){case"left":n.top=a.top,n.height=a.height,s.x<=0?(n.left=0,n.width=a.width+a.left):(n.left=s.x,n.width=a.width+(this.originalCoord.x-o.x)),n.width<=this.minWidth&&(n.width=this.minWidth,n.left=a.left+(a.width-n.width));break;case"top":n.top=s.y,n.left=a.left,n.width=a.width,n.height=a.height+(this.originalCoord.y-o.y),n.height<=this.minHeight&&(n.height=this.minHeight,n.top=a.top+(a.height-n.height)),n.top<=0&&(n.top=0,n.height=a.height+a.top);break;case"right":n.width=a.width-(this.originalCoord.x-o.x),n.height=a.height,n.top=a.top,n.left=a.left,n.width+a.left>=e&&(n.width=e),n.width<=this.minWidth&&(n.width=this.minWidth);break;case"bottom":n.height=a.height-(this.originalCoord.y-o.y),n.width=a.width,n.left=a.left,n.top=a.top,n.height>=i&&(n.height=i),n.height<=this.minHeight&&(n.height=this.minHeight);break;case"bottomRight":n.top=a.top,n.left=a.left,n.width=a.width-(this.originalCoord.x-o.x),n.width=n.width<this.minWidth?this.minWidth:n.width,n.height=this.getScaleHeight(n.width),n.width+n.left>=e&&(n.width=e-a.left,n.height=this.getScaleHeight(n.width)),n.top+n.height>=i&&(n.height=i-n.top,n.width=this.getScaleWidth(n.height))}this.css=n,this.options.cover?$cover.css(n):this.$elm.css(n),this._event.resize.call(this,n)},Resizable.prototype.stop=function(t,e){this.moving=!1,this.hideCover(),this.options.cover&&this.$elm.css(this.css),e[0].releaseCapture&&e[0].releaseCapture(),this._event.stop.call(this,this.css)},Resizable.prototype.showCover=function(){if(this.options.cover){var t=this.$elm;$cover.insertAfter(this.$elm).show().css({width:t.outerWidth(),height:t.outerHeight(),left:t.position().left,top:t.position().top})}},Resizable.prototype.hideCover=function(){$cover.hide()},Resizable.prototype.getMouseCoord=function(t){return{x:parseInt(t.pageX||t.clientX+document.body.scrollLeft-document.body.clientLeft),y:parseInt(t.pageY||t.clientY+document.body.scrollTop-document.body.clientTop)}},Resizable.prototype.getScaleWidth=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t*e:t/e},Resizable.prototype.getScaleHeight=function(t,e){return e=e||this.resizeParams.ratio,this.resizeParams.width>=this.resizeParams.height?t/e:t*e},Resizable.Global=function($elms){$elms=$elms||$("[data-module=resizable]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),onResize=$el.attr("data-onresize"),onStop=$el.attr("data-onstop"),data=$el.data("resizable");options&&options.length>0&&(options=eval("(0,"+options+")")),onResize=onResize&&onResize.length>0?eval("(0,"+onResize+")"):$.noop,onStop=onStop&&onStop.length>0?eval("(0,"+onStop+")"):$.noop,data||(data=new Resizable($el,options),data.on("resize",function(t){onResize.call(this,t)}).on("stop",function(t){onStop.call(this,t)}),$el.data("resizable",data))})},Resizable}),define("km/router",[],function(){var t={addEventListener:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i},removeEventListener:function(t,e){t.removeEventListener?t.removeEventListener(e,handler,!1):t.detachEvent?t.detachEvent("on"+e,handler):t["on"+e]=null},proxy:function(t,e){var i=function(){return t.apply(e||this,arguments)};return i}},e=function(){this._routes=[]};return e.prototype.init=function(){var e=this;t.addEventListener(window,"hashchange",t.proxy(e.listener,this)),this.listener()},e.prototype.listener=function(){var t,e=location.hash.slice(1).split("?"),i=e[0];e[1]&&(t=this.getUrlParams(e[1]));var o,s=this.getRoute(i),n={};if(!s)return void location.replace("#/");o=this.getValues(i,s);for(var a=0;a<s.params.length;a++)n[s.params[a]]=o[a];t=$.extend({},n,t),s.handle(t)},e.prototype.getUrlParams=function(t){var e={};if(!t)return e;for(var i,o=t.split("&"),s=0;s<o.length;s++)i=o[s].split("="),e[i[0]]=i[1];return e},e.prototype.map=function(t,e,i){var o,s,n,a=[];if(s=t.replace(/\//g,"\\/"),"function"==typeof e&&(i=e,e=null),e)for(var h in e)o=new RegExp("\\{"+h+"\\}","g"),s=s.replace(o,"("+e[h].replace(/\^/,"").replace(/\$/,"")+")"),a.push(h);for(o=new RegExp("{([^}]+)}","g");null!=(n=o.exec(s));)a.push(n[1]),o.lastIndex;return s="^"+s.replace(/{[^}]+}/gi,"(.+)")+"$",this._routes.push({routeUrl:t,pattern:s,params:a,handle:i||function(){}}),this},e.prototype.getValues=function(t,e){var e,i=[];if(0===t.length)return i;if(e=e||this.getRoute(t),null!=e){var o=t.match(e.pattern);if(0!=o.length)for(var s=1;s<o.length;s++)i.push(o[s])}return i},e.prototype.getRoute=function(t){for(var e=0;e<this._routes.length;e++)if(new RegExp(this._routes[e].pattern).test(t))return this._routes[e];return null},e}),define("km/slider",["jquery","km/dragdrop"],function(t,e){var i=function(e,i){this.$element=e,this.options=t.extend(!0,{min:1,max:10,step:1,value:1,$bindElement:t([]),callback:{slide:t.noop}},i),this.template='<div class="k-slider"><div class="k-slider-selection"></div><div class="k-slider-handle"></div></div>',this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.diff=this.max-this.min,this.init()};return i.prototype.init=function(){var i=this;this.$slider=t(this.template).appendTo(this.$element),this.$sliderSelection=this.$slider.find("div.k-slider-selection"),this.$sliderHandle=this.$slider.find("div.k-slider-handle"),this.handleWidth=this.$sliderHandle.width(),this.sliderWidth=this.$slider.outerWidth(),this.$bindElement=this.options.$bindElement,this.dragdrop=new e({$range:this.$slider,$layer:this.$slider.find(".k-slider-handle"),direction:"h",callback:{move:function(t){var e=i.getMoveValue(t);i.setValue(e),i.options.callback.slide(e)}}}),this.eventBind(),this.setValue(this.options.value)},i.prototype.eventBind=function(){if(this.allowElement()){var e=this.$bindElement[0].type,i=this;-1!==e.indexOf("select")?this.$bindElement.on("change.slider",function(){var e=t(this),o=t.trim(i.getFilterValue(e.val()));i.setValue(o)}):this.$bindElement.on("keyup.slider",function(e){var o=t(this),s=t.trim(i.getFilterValue(o.val()));13===e.keyCode&&i.setValue(s)}).on("blur.slider",function(){var e=t(this),o=t.trim(i.getFilterValue(e.val()));i.setValue(o)})}},i.prototype.allowElement=function(){if(0===this.$bindElement.length)return!1;var t=this.$bindElement[0].type;return"text"!==t&&"textarea"!==t&&-1===t.indexOf("select")?!1:!0},i.prototype.getFilterValue=function(t){return t||(t=this.min),isNaN(t)&&(t=this.min),t<this.min&&(t=this.min),t>this.max&&(t=this.max),t},i.prototype.setValue=function(t){t>this.max&&(t=this.max),t<this.min&&(t=this.min);var e=(t-this.min)/this.diff*100;this.setPercent(e),this.setElementValue(t)},i.prototype.setElementValue=function(t){if(this.allowElement()){var e=this.$bindElement[0].type;-1!=e.indexOf("select")?this.$bindElement.find("option[value='"+t+"']").prop("selected",!0):this.$bindElement.val(t)}},i.prototype.getMoveValue=function(t){var e=t.x/(this.sliderWidth-this.handleWidth)*100,i=Math.round(e/100*this.diff/this.step)*this.step+this.min;return i=i>this.max?this.max:i},i.prototype.setPercent=function(t){this.$sliderSelection.width(t+"%"),this.$sliderHandle.css("left",t+"%")},function(t,e){var o=new i(t,e);return o}}),define("km/switch",["jquery"],function($){var Switch=function(t,e){this.$element=t,this.options=$.extend(!0,{values:{on:{text:"是",value:!0,className:""},off:{text:"否",value:!1,className:""}},callback:{onclick:$.noop}},e),this.template='<div class="k-switch"></div>',this.init()};return Switch.prototype.init=function(){"checkbox"===this.$element[0].type&&(this.$switch=$(this.template).append(this.build()).insertAfter(this.$element),this.$switchScroller=this.$switch.find(".k-switch-scroller"),this.$element.hide(),this.checked="checked"===this.$element.attr("checked"),this.disabled="disabled"===this.$element.attr("disabled"),this.moveLeft=this.$switch.find(".k-switch-left").width(),this.checked?this.on():this.off(),this.disabled&&this.$switch.addClass("disabled"),this.$switch.on("click.switch",$.proxy(this.toggle,this)))},Switch.prototype.build=function(){var t=[],e=this.options.values;return t.push('<div class="k-switch-scroller">'),t.push('<span class="k-switch-left" >'+e.on.text+"</span>"),t.push('<span class="k-switch-middle"></span>'),t.push('<span class="k-switch-right">'+e.off.text+"</span>"),t.push("</div>"),t.join("")},Switch.prototype.toggle=function(){this.disabled||(this.checked?(this.checked=!1,this.off()):(this.checked=!0,this.on()),this.options.callback.onclick(this.get()))},Switch.prototype.on=function(){this.disabled||(this.$element.prop("checked",!0),this.$switchScroller.stop().animate({left:0},300))},Switch.prototype.off=function(){this.disabled||(this.$element.prop("checked",!1),this.$switchScroller.stop().animate({left:-this.moveLeft},300))},Switch.prototype.get=function(){var t=this.options.values;return this.checked?t.on.value||t.on.text:t.off.value||t.off.text},Switch.prototype.destroy=function(){this.$switch.off("click"),this.$element.show(),this.$switch.remove()},Switch.Global=function($elms){$elms=$elms||$('input[data-module="switch"]'),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),values=$el.attr("data-values"),funcName=$el.attr("data-onClick"),data=$el.data("switch");options=options&&options.length>0?eval("(0,"+options+")"):{values:values&&values.length>0?eval("(0,"+values+")"):void 0,callback:{onclick:funcName&&funcName.length>0?eval("(0,"+funcName+")"):$.noop}},data||(data=new Switch($el,options),$el.data("switch",data))})},Switch}),define("km/tagSelector",["jquery"],function($){var $selector,$layer,$left,$top,$right,$bottom,method={setSidePosition:function(t){var e={width:t.outerWidth(),height:t.outerHeight(),top:t.offset().top,left:t.offset().left},i=0;$left.css({left:e.left-i,top:e.top,height:e.height}).show(),$top.css({left:e.left,top:e.top-i,width:e.width+2*i}).show(),$right.css({left:e.left+e.width+i,top:e.top,height:e.height}).show(),$bottom.css({left:e.left,top:e.top+e.height+i,width:e.width+2*i}).show()},sideHide:function(){$left.hide(),$top.hide(),$right.hide(),$bottom.hide()},showLayer:function(t){var e={width:t.outerWidth(),height:t.outerHeight(),top:t.offset().top,left:t.offset().left};$layer.show().css(e)},hideLayer:function(){$layer.hide()}};return function($elms,options){if(!$elms||$elms instanceof $||(options=$elms,$elms=$("[data-module=tagselector]")),options=$.extend(!0,{callback:{onClick:$.noop}},options||{}),$elms=$elms||$("[data-module=tagselector]"),$elms=$elms.map(function(){return this.getAttribute("data-isInit")?void 0:(this.setAttribute("data-isInit",!0),this)}),$elms&&0!=$elms.length){if(!$selector){var html='<div class="k-tagSelector-layer"></div><div class="k-tagSelector-leftside"></div><div class="k-tagSelector-topside"></div><div class="k-tagSelector-rightside"></div><div class="k-tagSelector-bottomside"></div>';$selector=$(html).appendTo(document.body),$layer=$selector.filter("div.k-tagSelector-layer"),$left=$selector.filter("div.k-tagSelector-leftside"),$top=$selector.filter("div.k-tagSelector-topside"),$right=$selector.filter("div.k-tagSelector-rightside"),$bottom=$selector.filter("div.k-tagSelector-bottomside")}var $curElm;$elms.on("mouseover.tagSelector",function(){return method.setSidePosition($(this).addClass("k-tagSelector-curr")),!1}).on("mouseout.tagSelector",function(){$(this).removeClass("k-tagSelector-curr"),method.sideHide()}).on("click.tagSelector",function(){var $el=$(this),onclick=$el.attr("data-onclick");return $curElm=$el,method.showLayer($el,$layer),onclick&&onclick.length>0?(onclick=eval("(0,"+onclick+")"))($el):options.callback.onClick($el,$layer),!1}),$layer.on("click",function(){return $layer.hide(),!1}),$(window).on("resize.tagSelector",function(){$curElm&&method.showLayer($curElm,$layer)}),$(document).on("click.tagSelector",function(){$layer.hide(),$curElm=null
})}}}),define("km/tooltips",["jquery"],function($){function Tooltips(t,e){this.$element=t,this.options=$.extend(!0,{delay:0,content:"",tipClass:"",placement:"right",trigger:"hover click",container:$(document.body),type:"tooltips",scrollContainer:null,tpl:'<div class="k-tooltips"><div class="k-tooltips-arrow"></div><div class="k-tooltips-inner"></div></div>'},e),this.init()}return Tooltips.prototype.init=function(){var t=this;this.$tips=$(this.options.tpl),this.$tips.addClass(this.options.placement).addClass(this.options.tipClass),this.$container=$(this.options.container),this.setContent(),this.isShow=!1;for(var e,i=this.options.trigger.split(" "),o=0;o<i.length;o++)if(e=i[o],"click"===e)this.$element.on(e+"."+this.options.type,$.proxy(this.toggle,this));else if("manual"!=e){var s="hover"===e?"mouseenter":"focus",n="hover"===e?"mouseleave":"blur";this.$element.on(s+"."+this.options.type,$.proxy(this.show,this)),this.$element.on(n+"."+this.options.type,$.proxy(this.hide,this))}"BODY"!==this.$container[0].nodeName&&this.$container.css("position","relative"),this.$container.append(this.$tips),this.options.scrollContainer&&$(this.options.scrollContainer).on("scroll."+this.options.type,function(){}),$(window).on("resize."+this.options.type,function(){t.setPosition()}),this.hide()},Tooltips.prototype.setContent=function(t){t=$.trim(t||this.options.content),0===t.length&&(t=this.$element.attr("data-content")||"");var e=this.$tips;e.find(".k-tooltips-inner").html(t)},Tooltips.prototype.setPosition=function(){var t=this.getPosition();this.$tips.css(t)},Tooltips.prototype.getPosition=function(){var t,e=this.options.placement,i=(this.options.container,this.$element),o=(i.parent(),this.$tips),s=i.outerWidth(),n=i.outerHeight(),a=o.outerWidth(),h=o.outerHeight(),r={left:0,top:0},l=i[0];do r.left+=l.offsetLeft-l.scrollLeft,r.top+=l.offsetTop-l.scrollTop;while((l=l.offsetParent)&&l!=this.$container[0]);switch(e){case"left":t={top:r.top+n/2-h/2,left:r.left-a};break;case"top":t={top:r.top-h,left:r.left+s/2-a/2};break;case"right":t={top:r.top+n/2-h/2,left:r.left+s};break;case"bottom":t={top:r.top+n,left:r.left+s/2-a/2}}return t},Tooltips.prototype.show=function(){return 0===$.trim(this.options.content).length?void this.hide():(this.isShow=!0,this.setPosition(),this.$tips.show().addClass("in"),void this.setPosition())},Tooltips.prototype.hide=function(){this.isShow=!1,this.$tips.hide().removeClass("in")},Tooltips.prototype.toggle=function(){this.isShow?this.hide():this.show()},Tooltips.prototype.destroy=function(){this.$tips.remove()},Tooltips.Global=function($elements){var $elements=$elements||$('[data-module="tooltips"]');$elements.each(function(){var $this=$(this),tooltips=Tooltips.Get($this);if(!tooltips){var options=$this.attr("data-options");options=options&&options.length>0?eval("(0,"+options+")"):{title:$this.attr("data-title"),content:$this.attr("data-content"),placement:$this.attr("data-placement"),tipClass:$this.attr("data-tipClass"),trigger:$this.attr("data-trigger")},tooltips=new Tooltips($this,options),Tooltips.Set($this,tooltips)}})},Tooltips.Get=function(t){return t.data("tooltips")},Tooltips.Set=function(t,e){t.data("tooltips",e)},Tooltips}),define("km/tree",["jquery","km/dragdrop"],function(t){var e={className:{ICON:"icon",SWITCH:"switch"},floder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom"},node:{SELECTED:"selected"}},i={isArray:function(t){return t instanceof Array},getIndex:function(t,e){for(var i=0;i<e.length;i++)if(t.nodeId===e[i].nodeId)return i;return-1}},o=!1,s={getLineHtml:function(t,i){if(i.view.showLine){var o=e.line.CENTER;return t.isFirst&&0===t.parentId?o=e.line.ROOTS:t.isLast&&(o=e.line.BOTTOM),o+=t.hasChildren?t.open?"_"+e.floder.OPEN:"_"+e.floder.CLOSE:"_"+e.floder.DOCU,'<span id="switch_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+e.className.ICON+" "+e.className.SWITCH+" "+o+'"></span>'}},getIconHtml:function(t,i){return i.view.showIcon?(html='<span id="'+e.className.ICON+"_"+t.nodeId+'" class="'+e.className.ICON+" ico_"+e.floder.DOCU+'"></span>',t.hasChildren&&(html=t.open?'<span id="'+e.className.ICON+"_"+t.nodeId+'"  class="'+e.className.ICON+" ico_"+e.floder.OPEN+'"></span>':'<span id="'+e.className.ICON+"_"+t.nodeId+'"  class="'+e.className.ICON+" ico_"+e.floder.CLOSE+'"></span>'),html):void 0},getChkHtml:function(t,i){if(!i.check.enable||t.noCheck)return"";var s,n=String(t.checked===!0);return"radio"===i.check.chkType&&(o?n=!1:o=!0),s=i.check.chkType+"_"+n+"_"+(t.chkDisabled?"part":"full"),'<span id="chk_'+t.nodeId+'" nId="'+t.nodeId+'" class="'+e.className.ICON+" chk "+s+'"></span>'},replaceSwitchClass:function(t,i){var o=t.attr("class");if(o){var s=o.split("_");switch(i){case e.line.ROOT:case e.line.ROOTS:case e.line.CENTER:case e.line.BOTTOM:s[0]=e.className.ICON+" "+e.className.SWITCH+" "+i;break;case e.floder.OPEN:case e.floder.CLOSE:case e.floder.DOCU:s[1]=i}t.attr("class",s.join("_"))}},replaceChkClass:function(t,e){t.attr("class",t.attr("class").replace(e?"false":"true",e?"true":"false"))}},n=function(e,i){this.$element=e,this.options=t.extend(!0,{data:[],edit:{enable:!1},check:{enable:!1,chkType:"checkbox",chkBoxType:{Y:"ps",N:"ps"}},callback:{beforeCheck:t.noop,beforeSelect:t.noop,beforeAdd:t.noop,beforeRemove:t.noop,onCheck:t.noop,onSelect:t.noop,onAdd:t.noop,onRemove:t.noop},view:{showLine:!0,showIcon:!0}},i),this.nodes={},this.prefix="node",this.init()};return n.prototype.init=function(){this.initNodes(this.options.data),this.createTree(),this.eventBind()},n.prototype.initNodes=function(t){if(i.isArray(t)&&0!==t.length)for(var e,o=0;o<t.length;o++)e=t[o],0===o&&o+1<t.length?e.isFirst=!0:o+1===t.length&&(e.isLast=!0),e.hasChildren=this.hasChildren(e),e.isParent=e.hasChildren,this.nodes[this.prefix+e.nodeId]=e,this.initNodes(e.nodes)},n.prototype.eventBind=function(){var i=this;this.$element.on("click.tree","."+e.className.SWITCH,function(){var o=t(this),n=o.attr("nId"),a=i.$tree.find("#ul_"+n),h=i.$tree.find("#icon_"+n);0!==a.length&&a.slideToggle("fast",function(){s.replaceSwitchClass(o,"none"===a[0].style.display?e.floder.CLOSE:e.floder.OPEN),s.replaceSwitchClass(h,"none"===a[0].style.display?e.floder.CLOSE:e.floder.OPEN)})}).on("click.tree",".chk",function(){var e=t(this),o=e.attr("nId"),n=i.getNode(o),a=this.className,h=i.getCheckedNodes(),r=-1===a.indexOf("true");if(i.options.callback.beforeCheck()!==!1&&!n.chkDisabled){if(n.checked=r,s.replaceChkClass(e,n.checked),"checkbox"===i.options.check.chkType)i.check(n);else for(var l=0;l<h.length;l++)h[l]!=n&&(h[l].checked=!1,s.replaceChkClass(i.$tree.find("#chk_"+h[l].nodeId),!1));i.options.callback.onCheck(n)}}).on("click.tree","a",function(){var o=t(this);i.options.callback.beforeSelect()!==!1&&(o.hasClass(e.node.SELECTED)||(i.$element.find("a").removeClass(e.node.SELECTED),o.addClass(e.node.SELECTED),i.options.callback.onSelect(i.getSelectedNode())))}).on("click.tree",".add",function(){t(this)}).on("click.tree",".edit",function(){t(this)}).on("click.tree",".remove",function(){t(this)})},n.prototype.createTree=function(){var e=[];e.push('<ul class="k-tree">'),this.createNode(this.options.data,e),e.push("</ul>"),this.$tree=t(e.join("")),this.$element.append(this.$tree)},n.prototype.createNode=function(t,e,o){var n,a="line";if(i.isArray(t)&&0!==t.length&&i.isArray(e)){o&&(o.isLast&&(a=""),e.push(o.open?'<ul id="ul_'+o.nodeId+'" class="'+a+'">':'<ul id="ul_'+o.nodeId+'" style="display:none;" class="'+a+'" >'));for(var n,h=0;h<t.length;h++)n=this.getNode(t[h].nodeId),n&&(e.push('<li id="li_'+n.nodeId+'" nId="'+n.nodeId+'">'),e.push(s.getLineHtml(n,this.options)),e.push(s.getChkHtml(n,this.options)),e.push('<a href="javascript:void(0);" id="a_'+n.nodeId+'" nId="'+n.nodeId+'">'),e.push(s.getIconHtml(n,this.options)),e.push("<span>"+n.text+"</span>"),e.push("</a>"),this.createNode(n.nodes,e,n),e.push("</li>"));o&&e.push("</ul>")}},n.prototype.addNodes=function(o,n){var o,a=[];if(i.isArray(n)||(n=[n]),o=o||this.getNode(n[0].parentId),this.initNodes(n),this.createNode(n,a),o){var h=this.$tree.find("#li_"+o.nodeId),r=h.find("#ul_"+o.nodeId);if(0===r.length){o.nodes=n;var l=h.find("#"+e.className.SWITCH+"_"+o.nodeId),d=h.find("#"+e.className.ICON+"_"+o.nodeId);r=t('<ul class="'+(o.isLast?"":"line")+'" />').attr("id","ul_"+o.nodeId),s.replaceSwitchClass(l,e.floder.OPEN),s.replaceSwitchClass(d,e.floder.OPEN)}else{var p=o.nodes[o.nodes.length-1],c=h.find("#li_"+p.nodeId);c.children("ul").addClass("line");var l=c.find("#"+e.className.SWITCH+"_"+p.nodeId);p.isLast=!1,s.replaceSwitchClass(l,e.line.CENTER),Array.prototype.push.apply(o.nodes,n)}r.append(a.join("")).appendTo(h)}else{var c=this.$tree.children("li").last(),u=c.find("#ul_"+c.attr("nid"));u.addClass("line"),this.$tree.append(a.join(""))}},n.prototype.removeNode=function(t){if(t){for(var o=this.getNode(t.parentId),n=this.getChildNodes(t),a=this.$tree.find("#li_"+t.parentId),h=this.$tree.find("#li_"+t.nodeId),r=h.prev(),l=h.next(),d=this.getNode(r.attr("nId")),p=this.getNode(l.attr("nId")),c=0;c<n.length;c++)this.$tree.find("#li_"+n[c].nodeId).remove(),delete this.nodes[this.prefix+n[c].nodeId];if(o){var u=i.getIndex(t,o.nodes);u>=0&&o.nodes.splice(u,1),0===o.nodes.length&&(h.parent().remove(),o.isParent=!1,o.open=!1,s.replaceSwitchClass(a.find("#"+e.className.SWITCH+"_"+o.nodeId),e.floder.DOCU),s.replaceSwitchClass(a.find("#"+e.className.ICON+"_"+o.nodeId),e.floder.DOCU))}d&&t.isLast&&(d.isLast=!0,r.children("ul").removeClass("line"),d.isFirst&&0===d.parentId?s.replaceSwitchClass(r.find("#"+e.className.SWITCH+"_"+d.nodeId),e.line.ROOT):s.replaceSwitchClass(r.find("#"+e.className.SWITCH+"_"+d.nodeId),e.line.BOTTOM)),t.isFirst&&0===t.parentId&&p&&(p.isFirst=!0,s.replaceSwitchClass(l.find("#"+e.className.SWITCH+"_"+p.nodeId),e.line.ROOT)),h.remove(),delete this.nodes[this.prefix+t.nodeId]}},n.prototype.check=function(t){function e(t,e){for(var o=!0;t&&i.isArray(t.nodes);){for(var s,n=0;n<t.nodes.length;n++)if(s=t.nodes[n],s.checked){o=!1;break}if(!o)return;this.checkAction([t],e),o=!0,t=this.getNode(t.parentId)}}var o=this.getParentNodes(t),s=this.getChildNodes(t),n=this.getNode(t.parentId),a=this.options;if(t.checked)switch(a.check.chkBoxType.Y.toLowerCase()){case"p":this.checkAction(o,t.checked);break;case"s":this.checkAction(s,t.checked);break;case"ps":this.checkAction(o,t.checked),this.checkAction(s,t.checked)}else switch(a.check.chkBoxType.N.toLowerCase()){case"p":e.call(this,n,t.checked);break;case"s":this.checkAction(s,t.checked);break;case"ps":e.call(this,n,t.checked),this.checkAction(s,t.checked)}},n.prototype.checkAction=function(t,e){for(var i,o,n=0;n<t.length;n++)i=t[n],i.checked=e,o=this.$tree.find("#chk_"+i.nodeId),i.chkDisabled||s.replaceChkClass(o,e)},n.prototype.getParentChildNodes=function(t){var e=this.getParentNodes(t);return this.getChildNodes(t,e),e},n.prototype.getParentNodes=function(t){for(var e=this.nodes[this.prefix+t.parentId],i=[];e;)i.push(e),e=this.nodes[this.prefix+e.parentId];return i},n.prototype.getChildNodes=function(t,e){if(e||(e=[]),!i.isArray(t.nodes))return e;for(var o=0;o<t.nodes.length;o++)e.push(t.nodes[o]),this.getChildNodes(t.nodes[o],e);return e},n.prototype.getSelectedNode=function(){var t=this.$tree.find("a.selected");if(0===t.length)return null;var e=t.attr("nId");return this.getNode(e)},n.prototype.getCheckedNodes=function(){var t=[];for(var e in this.nodes)this.nodes[e].checked&&t.push(this.nodes[e]);return t},n.prototype.getNode=function(t){return this.nodes[this.prefix+t]},n.prototype.hasChildren=function(t){return t&&i.isArray(t.nodes)&&t.nodes.length>0?!0:!1},n}),define("km/treeTable",["jquery","km/ajax"],function(t,e){function i(e,i){this.$elm=e,this.options=t.extend(!0,{expanded:!0,className:"k-treeTable",url:"",params:null,column:0,columns:[],data:[],checkType:{Y:"ps",N:"ps"}},i),this.init()}return i.prototype.init=function(){var t=this;this.options.data&&this.options.data.length>0?(this.data=this.options.data,this.dataInit(),this.build(),this.watch()):this.options.url&&this.options.url.length>0&&e.get(this.options.url,this.options.params).done(function(e){t.data=e.Data,t.dataInit(),t.build(),t.watch()})},i.prototype.watch=function(){var e=this;this.$elm.on("click.treetable",".indenter a",function(){var i=t(this).attr("data-nodeId"),o=t("#treeRow_"+i),s=e.getChildren(e.objData[i]);return o.hasClass("expanded")?(o.removeClass("expanded").addClass("collapsed"),e.collapsed(s)):(o.removeClass("collapsed").addClass("expanded"),e.expanded(s)),!1}).on("click.treetable","tbody tr",function(){var i=t(this),o=i.attr("data-nodeId"),s=e.objData[o];s.enableCheck&&(i.hasClass("selected")?(i.removeClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!1),s.checked=!1,e.check(s,!1)):(i.addClass("selected"),i.find("td:eq(0)").find("input").prop("checked",!0),s.checked=!0,e.check(s,!0)))}).on("click.treetable","[role=checkall]",function(){for(var i,o=t(this),s=(e.$elm.find("tbody tr"),o.prop("checked")),n=0;n<e.data.length;n++)i=e.data[n],i.enableCheck&&(i.checked=s,s?(t("#treeRow_"+i.nodeId).addClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!0)):(t("#treeRow_"+i.nodeId).removeClass("selected"),t("#treeCheckBox_"+i.nodeId).prop("checked",!1))),e.data[n].checked=s})},i.prototype.dataInit=function(){function e(e,i){var o=function(i,s,n){for(var a,h=0;h<e.length;h++)a=e[h],a.parentId==i&&(a.hasParent=!0,0==a.parentId&&(a.isRoot=!0,a.level=1,a.hasParent=!1),n&&(n.hasChild=!0,a.level=n.level+1||1,a.parent=n,t.isArray(n.children)||(n.children=[]),n.children.push(a.nodeId)),s.push(a),o(a.nodeId,s,a))};o(0,i,null,1)}{var i=[];this.data}this.objData={},e(this.data,i),0==i.length&&(i=this.data);for(var o=0;o<i.length;o++)this.objData[i[o].nodeId]=i[o],(null==i[o].enableCheck||"undefined"==typeof i[o].enableCheck)&&(i[o].enableCheck=!0);this.data=i},i.prototype.build=function(){var t=[],e=this.options.columns;t.push('<table class="'+this.options.className+'">'),t.push("<thead>");for(var i,o=0;o<e.length;o++)i=e[o],i.checkbox?(t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" role="checkall" />'),t.push("</th>")):t.push('<th style="text-align:'+(i.align?i.align:"left")+'">'+i.title+"</th>");t.push("</thead>"),t.push("<tbody>");for(var s,n,a,o=0;o<this.data.length;o++){s=this.data[o],n="",a="",s.hasChild&&(this.options.expanded?n="expanded":(n="collapsed",s.isRoot||(a="hide"))),!this.options.expanded&&s.hasParent&&s.parentId>0&&(a="hide");var h="";this.options.columns[0].checkbox&&s.checked&&(h="selected"),t.push('<tr class="'+n+" "+a+" "+h+'" id="treeRow_'+s.nodeId+'"  data-parentId="'+s.parentId+'" data-nodeId="'+s.nodeId+'" data-level="'+s.level+'">');for(var i,r=0;r<e.length;r++)if(i=e[r],i.checkbox){var l="";s.checked&&(l=' checked="checked" '),s.enableCheck||(l+=' disabled="disabled" '),t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push('<input type="checkbox" id="treeCheckBox_'+s.nodeId+'" value="'+s[i.field]+'"  '+l+"  />"),t.push("</td>")}else{var d="",p="";r==this.options.column&&(s.hasChild?(d='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"><a href="#" title="Collapse" data-nodeId="'+s.nodeId+'">&nbsp;</a></span>',p='<span class="folder">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>"):(d='<span class="indenter" style="padding-left: '+(s.level>1?19*s.level:0)+'px;"></span>',p='<span class="file">'+("function"==typeof i.formatter?i.formatter(s[i.field],s):s[i.field])+"</span>")),"function"==typeof i.formatter?(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(d),t.push(p.length>0?p:i.formatter(s[i.field],s)),t.push("</td>")):(t.push('<td style="text-align:'+(i.align?i.align:"left")+'">'),t.push(d),t.push(p.length>0?p:s[i.field]),t.push("</td>"))}t.push("</tr>")}t.push("</tbody>"),t.push("</table>"),this.$elm.html(t.join(""))},i.prototype.check=function(e,i){function o(i,o){for(var s=0;s<o.length;s++)if(o[s].checked){h=!1;break}var n=e.parent;for(h&&n&&n.enableCheck&&(n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1));n;){for(var a=this.getBrothers(n),s=0;s<a.length;s++)if(a[s].checked){h=!1;break}if(!h||!n.enableCheck)break;n.checked=!1,t("#treeRow_"+n.nodeId).removeClass("selected"),t("#treeCheckBox_"+n.nodeId).prop("checked",!1),n=n.parent}}{var s=this.getParents(e),n=this.getChildren(e),a=this.getBrothers(e),h=!0;t("#treeRow_"+e.nodeId),t("#treeCheckBox_"+e.nodeId)}if(i)switch(this.options.checkType.Y.toLowerCase()){case"p":this.checkAction(s,i);break;case"s":this.checkAction(n,i);break;default:this.checkAction(s,i),this.checkAction(n,i)}else switch(this.options.checkType.N.toLowerCase()){case"p":o.call(this,e,a);break;case"s":this.checkAction(n,i);break;default:o.call(this,e,a),this.checkAction(n,i)}},i.prototype.checkAction=function(e,i){for(var o,s,n,a=0;a<e.length;a++)o=e[a],n=t("#treeCheckBox_"+o.nodeId),s=t("#treeRow_"+o.nodeId),o.enableCheck&&(i?(o.checked=!0,s.addClass("selected"),n.prop("checked",!0)):(o.checked=!1,s.removeClass("selected"),n.prop("checked",!1)))},i.prototype.expanded=function(e){for(var i,o,s,n=0;n<e.length;n++)i=e[n],o=t("#treeRow_"+i.nodeId),s=t("#treeRow_"+i.parentId),s.hasClass("collapsed")?o.addClass("hide"):o.removeClass("hide")},i.prototype.collapsed=function(e){for(var i,o,s=0;s<e.length;s++)i=e[s],o=t("#treeRow_"+i.nodeId),o.addClass("hide")},i.prototype.getParents=function(t){for(var e=[],i=t.parent;i;)e.push(i),i=i.parent;return e},i.prototype.getBrothers=function(t){for(var e,i=[],o=0;o<this.data.length;o++)e=this.data[o],t.parentId==e.parentId&&e.nodeId!=t.nodeId&&i.push(e);return i},i.prototype.getChildren=function(t){var e=[],i=function(t,e,o){if(t.children)for(var s,n=0;n<t.children.length;n++)s=o[t.children[n]],e.push(s),s.hasChild&&i(s,e,o)};return i(t,e,this.objData),e},i.prototype.reload=function(){},i.prototype.loadData=function(){},i}),define("km/upload",["jquery","spin","km/window","km/ajax","km/event"],function($,Spinner,Window,ajax,event){var method={showLoading:function(){this.spinner.spin(this.$loadingBox.get(0)),this.$loadingBox.css("display","inline-block"),this.$uploadIcon.hide()},hideLoading:function(){this.$loadingBox.hide(),this.spinner.stop(),this.$uploadIcon.show()}},Upload=function(t,e){this.$elm=t,this.options=$.extend(!0,{uploadUrl:"",removeUrl:"",fontClassName:"fa fa-upload",text:"上传",name:"file",popTips:{enable:!0,delay:600}},e),this.isLoading=!1,this.isButton="text"==this.$elm[0].type.toLowerCase()?!1:!0,this.event=event,this.init()};return Upload.prototype.init=function(){this.spinner=new Spinner({lines:9,length:3,width:2,radius:2,scale:.2,corners:.6,rotate:4,direction:1,color:"#222222",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"5px",left:"10px"}),this.build(),this.watch()},Upload.prototype.watch=function(){var t=this;this.$uploadBox.on("change.upload","input",function(){t.upload()}).on("click.upload",".fa-close",function(){t.isLoading||Window.confirm("您确认要删除该文件吗？",function(){t.removeFile()})})},Upload.prototype.build=function(){var t=[],e=[];t.push('<div class="k-upload-box">'),this.isButton&&(t.push('<div class="k-upload-result">'),t.push("<span></span>"),t.push('<i class="fa fa-close"></i>'),t.push("</div>")),t.push('<div class="button-box">'),t.push('<button type="button" class="k-btn k-btn-default">'),t.push('<div class="loading-box"></div>'),t.push('<span class="k-upload-icon '+this.options.fontClassName+'"></span>&nbsp;'),t.push(this.options.text),t.push("</button>"),t.push('<form action="'+this.options.uploadUrl+'" enctype="multipart/form-data" method="post">'),t.push('<input type="file" name="'+this.options.name+'" />'),t.push("</form>"),t.push("</div>"),t.push("</div>"),this.isButton||(e.push('<div class="k-input-group k-input-group-upload">'),e.push('<i class="fa fa-close"></i>'),e.push('<span class="k-input-group-btn">'),e.push(t.join("")),e.push("</span>"),e.push("</div>")),this.$uploadBox=$(0==e.length?t.join(""):e.join("")),this.$buttonBox=this.$uploadBox.find(".button-box"),this.$button=this.$uploadBox.find("button"),this.$file=this.$uploadBox.find("input[type=file]"),this.$form=this.$uploadBox.find("form"),this.$resultBox=this.$uploadBox.find(".k-upload-result"),this.$txtResult=this.isButton?null:this.$elm,this.$close=this.$uploadBox.find(".fa-close"),this.$uploadBox.appendTo(this.$elm.parent()),this.$uploadIcon=this.$uploadBox.find(".k-upload-icon"),this.$loadingBox=this.$buttonBox.find(".loading-box"),this.isButton?this.$elm.hide():(this.$elm.attr({"class":"k-form-control",readonly:"readonly"}).prependTo(this.$uploadBox),this.$close.css("right",this.$button.outerWidth()+10))},Upload.prototype.upload=function(){var t=this;this.isLoading||(this.isLoading=!0,method.showLoading.call(this),ajax.ajaxForm(this.$form,{loadingEnable:!1,redirectEnable:!1,popTips:{enable:this.options.popTips.enable,delay:this.options.delay,inCallback:!1}}).done(function(e){t.showResult(e.Url||"")}).always(function(){t.isLoading=!1,method.hideLoading.call(t)}))},Upload.prototype.removeFile=function(t){var e=this;this.isLoading||(this.isLoading=!0,ajax.post(this.options.removeUrl,t||{filePath:this.url},{redirectEnable:!1,loadingEnable:!0,popTips:{enable:this.options.popTips.enable,delay:this.options.delay,inCallback:!1}}).done(function(t){(t.Status||t.status)&&e.hideResult()}).always(function(){e.isLoading=!1}))},Upload.prototype.showResult=function(t){this.url=t,this.isButton?(this.$resultBox.children("span").text(t).end().fadeIn(),this.$buttonBox.hide()):(this.$txtResult.val(t),this.$close.fadeIn())},Upload.prototype.hideResult=function(){this.isButton?(this.$resultBox.children("span").text("").end().hide(),this.$buttonBox.fadeIn()):(this.$txtResult.val(""),this.$close.hide())},Upload.prototype.on=function(t,e){var i=this;this.event.on(t+".upload",function(t){e.apply(i,t)})},Upload.Global=function($elms){$elms=$elms||$("button[data-module=upload],input[data-module=upload]"),$elms.each(function(){var $el=$(this),options=$el.attr("data-options"),uploadUrl=$el.attr("data-uploadurl"),removeUrl=$el.attr("data-removeurl"),name=$el.attr("data-name"),text=$el.attr("data-text"),loadingEnable=$el.attr("data-loadingEnable"),popTips=$el.attr("data-popTips"),data=$el.data("upload");options=options&&options.length>0?eval("(0,"+options+")"):{uploadUrl:uploadUrl&&uploadUrl.length>0?uploadUrl:"",removeUrl:removeUrl&&removeUrl.length>0?removeUrl:"",name:name&&name.length>0?name:"file",text:text&&text.length>0?text:"上传",loadingEnable:loadingEnable&&"false"==loadingEnable?!1:!0,popTips:popTips&&popTips.length>0?eval("(0,"+popTips+")"):{}},data||(data=new Upload($el,options),$el.data("upload",data))})},Upload}),define("km/util",function(){var t={},e=function(){};return t.createProto=Object.__proto__?function(t){return{__proto__:t}}:function(t){return e.prototype=t,new e},t}),define("km/validate",["jquery"],function($){function Validate(t,e){this.$form=t,this.options=$.extend(!0,{errorClass:"k-error",errorElement:"label",rules:{},messages:{},tipsPlacement:{},focusClear:!0,keyupClear:!0,errorPlacement:null,showSingleError:!1},e),this.rules=this.options.rules,this.messages=this.options.messages,this.tipsPlacement=this.options.tipsPlacement,this.init()}return Validate.prototype.init=function(){this.getValidFields(),0!==this.validFields.count&&(this.eventBind(),this.$form.data("validate",this))},Validate.prototype.getValidFields=function(){this.validFields={data:{},count:0};{var t=this;this.$form.find("input,select,textarea").filter(function(){return this.getAttribute("data-rules")&&t.metaRules(this),this.name in t.rules?!0:!1}).each(function(){if(!t.validFields.data[this.name]){var e=$(this);e.data("$form",t.$form),t.validFields.data[this.name]=e,t.validFields.count++}})}},Validate.prototype.metaRules=function(element){var meta=element.getAttribute("data-rules");meta=eval("(0,"+meta+")"),this.rules[element.name]?($.extend(meta.rules,this.rules[element.name],!0),this.rules[element.name]=meta.rules):this.rules[element.name]=meta.rules,this.messages[element.name]?($.extend(meta.messages,this.messages[element.name],!0),this.messages[element.name]=meta.messages):this.messages[element.name]=meta.messages,this.tipsPlacement[element.name]||(this.tipsPlacement[element.name]=meta.tipsPlacement||{position:"right",target:element})},Validate.prototype.eventBind=function(){var t=this;this.$form.on("submit",function(e){return t.validateFrom(e)}).on("focus.validate blur.validate keyup.validate",':text, [type="password"], [type="file"], select, textarea, [type="number"], [type="search"] ,[type="tel"], [type="url"], [type="email"], [type="datetime"], [type="date"], [type="month"], [type="week"], [type="time"], [type="datetime-local"], [type="range"], [type="color"]',function(e){t.validate(e)}).on("click.validate",'[type="radio"], [type="checkbox"], select, option',function(e){t.validate(e)})},Validate.prototype.validate=function(t){var e,i,o=t.target,s=$(o),n=this.rules[o.name];if(n){if(this.options.focusClear&&("focusin"===t.type||"click"==t.type)||this.options.keyupClear&&"keyup"===t.type)return void this.hideError(s);i=this.elementValue(s);for(var a in n){var h={method:a,parameters:n[a]};if(e=this.methods[a].call(this,i,s,h.parameters),!e)return this.formatAndAdd(o,h),!1;this.hideError(s)}return!0}},Validate.prototype.validateFrom=function(){var t=this,e=!0,i=[];for(var o in this.validFields.data)t.validate({target:this.validFields.data[o][0]})||(e=!1,i.push({$element:$(this.validFields.data[o][0])}));if(this.options.showSingleError&&i.length>1)for(var s=1;s<i.length;s++)$element=i[s].$element,this.hideError($element,!1);return e},Validate.prototype.valid=function(){return this.validateFrom()},Validate.prototype.checkable=function(t){return/radio|checkbox/i.test(t.type)},Validate.prototype.formatAndAdd=function(t,e){var i=$(t),o=this.defaultMessage(t,e.method);o=this.format(o,e.parameters),this.showError(i,o)},Validate.prototype.showError=function(t,e){this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=t.data("error");i||(i=$("<"+this.options.errorElement+">").addClass(this.options.errorClass),t.data("error",i)),i.html(e).show(),t.addClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)?this.options.errorPlacement(t,i):i.insertAfter(t)},Validate.prototype.hideError=function(t,e){"undefined"==typeof e&&(e=!0),this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var i=t.data("error");e&&t.removeClass(this.options.errorClass),$.isFunction(this.options.errorPlacement)&&this.options.errorPlacement(t,$([])),i&&i.hide()},Validate.prototype.hideAllError=function(){for(var t in this.validFields.data)this.hideError($(this.validFields.data[t][0]))},Validate.prototype.defaultMessage=function(t,e){return this.messages[t.name]||(this.messages[t.name]={},this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]||(this.messages[t.name][e]=this.errorMessages[e]),this.messages[t.name][e]},Validate.prototype.format=function(t,e){return-1!=t.indexOf("{0}")&&(e.constructor!==Array&&(e=[e]),$.each(e,function(e,i){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return i})})),t},Validate.prototype.removeRule=function(t,e){this.rules[t.name]&&this.rules[t.name][e]&&delete this.rules[t.name][e],this.messages[t.name]&&this.messages[t.name][e]&&delete this.messages[t.name][e]},Validate.prototype.setRules=function(t,e){this.rules[t.name]?$.extend(this.rules[t.name],e.rules,!0):this.rules[t.name]=e.rules,this.messages[t.name]?$.extend(this.messages[t.name],e.messages,!0):this.messages[t.name]=e.messages},Validate.prototype.addMethod=function(t,e,i){this.methods[t]=e,this.errorMessages[t]=void 0!==i?i:this.errorMessages[t]},Validate.prototype.errorMessages={required:"该字段不能为空",email:"电子邮箱格式错误",url:"url格式错误",date:"请输入一个有效日期",dateISO:"请输入一个有效日期（ISO）",mobile:"手机号码格式错误",phone:"电话号码格式错误",number:"请输入一个有效的数字",digits:"请输入正整数",minLength:"请输入一个长度不小于{0}个字符的值",maxLength:"请输入一个长度不大于{0}个字符的值",rangeLength:"请输入一个长度介于{0}到{1}个字符的值",min:"请输入一个大于或等于{0}的值",max:"请输入一个小于或等于{0}的值",range:"请输入一个介于{0}到{1}之间的数值",equalTo:"请再输入一个相同的值",remote:"远程验证失败"},Validate.prototype.methods={required:function(t,e){if("select"===e[0].nodeName.toLowerCase()){var i=$.trim(e.val());return i&&i.length>0}return this.checkable(e[0])?this.getLength(t,e[0])>0:$.trim(t).length>0},email:function(t,e){return this.optional(e)||/^(?:[a-z0-9]+[_\-+.]+)*[a-z0-9]+@(?:([a-z0-9]+-?)*[a-z0-9]+.)+([a-z]{2,})+$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}|\d{4}[\/-]\d{1,2}[\/-]\d{1,2}\s\d{1,2}[:]\d{1,2}[:]\d{1,2}\w$/.test(t)},mobile:function(t,e){return this.optional(e)||/^1\d{10}$/.test(t)},phone:function(t,e){return this.optional(e)||/^((0\d{2,3}\-)[1-9]\d{7}(\-\d{1,4})?)$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},minLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i},maxLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||i>=o},rangeLength:function(t,e,i){var o=$.isArray(t)?t.length:this.getLength($.trim(t),e[0]);return this.optional(e)||o>=i[0]&&o<=i[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(t,e,i){var e=$(i);return t===this.elementValue(e)},remote:function(t,e,i){var o,s={},n=this,a=this.previousValue(e[0]);return a.old===t?a.valid:(a.old=t,"string"==typeof i?o=i:(o=i.url,s=i.data),s[e[0].name]=t,s.rnd=Math.random(),$.post(o,s).success(function(t){var i=t===!0||"true"===String(t).toLowerCase();i?n.hideError(e):n.showError(e,a.message),a.valid=i}).error(function(){return!1}),!0)}},Validate.prototype.previousValue=function(t){return $.data(t,"previousValue")||$.data(t,"previousValue",{old:null,valid:!0,message:this.defaultMessage(t,"remote")})},Validate.prototype.optional=function(t){var e=this.elementValue(t);return!this.methods.required.call(this,e,t)},Validate.prototype.elementValue=function(t){var e=t.attr("type"),i=t.val();return"radio"===e||"checkbox"===e?$("input[name='"+t.attr("name")+"']:checked").val():"string"==typeof i?i.replace(/\r/g,""):i},Validate.prototype.getLength=function(t,e){switch(e.nodeName.toLowerCase()){case"select":return $("option:selected",e).length;case"input":if(this.checkable(e))return this.$form.find("[name='"+e.name+"']").filter(":checked").length}return t.length
},Validate.prototype.getData=function(){var t={},e=this;return e.$form.find("input[name], textarea[name]").each(function(){var e=$(this);if(e.is("[type=checkbox]")===!1&&e.is("[type=radio]")===!1)t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=radio]:checked"))t[e.attr("name")]=$.trim(e.val());else if(e.is("[type=checkbox]:checked")){var i=e.attr("name");t[i]||(t[i]=[]),t[i].push(e.val())}}),t},Validate}),define("km/validateTooltips",["jquery","km/validate","km/tooltips","km/util"],function(t,e,i,o){var s=function(t,i){e.call(this,t,i)};return s.prototype=o.createProto(e.prototype),s.prototype.getTipsPlacement=function(t){var e=t.name,i="right";return this.tipsPlacement||(this.tipsPlacement=this.options.tipsPlacement||{}),this.tipsPlacement[e]?i=this.tipsPlacement[e]:this.tipsPlacement[e]={position:"right",target:t},i},s.prototype.showError=function(e,o){var s;this.checkable(e[0])&&(e=this.validFields.data[e[0].name]);var n=this.getTipsPlacement(e[0]);n.target?(s=t(n.target),e.data("$target",s)):s=e;var a=i.Get(s);a?a.setContent(o):(a=new i(s,{content:o,tipClass:"danger",trigger:"manual",placement:n.position,container:this.options.container||document.body,scrollContainer:this.options.scrollContainer}),i.Set(s,a)),a.show(),s.addClass(this.options.errorClass)},s.prototype.hideError=function(t,e){"undefined"==typeof e&&(e=!0),this.checkable(t[0])&&(t=this.validFields.data[t[0].name]);var o=t.data("$target");o&&(t=o);var s=i.Get(t);s&&s.hide(),e&&t.removeClass(this.options.errorClass)},s}),define("km/waterfall",["jquery","km/infiniteScroll","km/popTips"],function(t,e,i){var o=function(e,i){this.$element=e,this.options=t.extend(!0,{$scrollElement:t(window),scrollDistance:0,width:200,left:10,margin:20,nodeTag:"li",resize:!0,url:null,loaded:t.noop,mobilePhone:!1,pageSize:20},i),this.$panel=this.options.$scrollElement,this.$document=t(document),this.loading=!1,this.noMore=!1,this.page=1,this.init()};return o.prototype.init=function(){var i=this;this.options.mobilePhone&&(this.options.width=(this.$panel.width()-this.options.margin)/2),this.arrangementInit(),this.infiniteScroll=new e({$watchElement:this.$element,$scrollElement:this.options.$scrollElement,scrollDistance:this.options.scrollDistance,callback:function(){return i.options.url?void i.remote():void(i.options.data&&i.options.data.length>0&&i.options.loaded.call(i,i.$element,i.options.data))}}),this.options.resize&&this.$panel.on("resize.waterfall",t.proxy(this.arrangementInit,this))},o.prototype.arrangementInit=function(){this.arrHeight=[],this.nodes=this.$element.children(this.options.nodeTag);var t=this.$panel.width();if(0!==this.nodes.length){this.options.mobilePhone&&(this.options.width=(t-this.options.margin)/2);var e=parseInt(t/this.options.width),i=e*this.options.width+(e-1)*this.options.left;if(i>t&&(e-=1,i=e*this.options.width+(e-1)*this.options.left),!(i<this.options.width)){this.$element.width(i),this.options.mobilePhone&&this.nodes.width(this.options.width);for(var o,s,n=0;n<this.nodes.length;n++)s=this.nodes.eq(n),o=s.outerHeight(),e>n?(this.arrHeight[n]=o,s.css({top:0,left:n*(this.options.width+this.options.left)})):this.set(s,o);this.adpHeight()}}},o.prototype.arrangement=function(e){var i=this;return 0===this.arrHeight.length?void this.arrangementInit():void(e&&0!==e.length&&(e.each(function(){var e=t(this),o=e.outerHeight();i.set(e,o)}),this.adpHeight()))},o.prototype.set=function(t,e){var i=this.getMinHeight(),o=this.getMinHeightIndex(i);o=-1==o?0:o,this.arrHeight[o]+=e+this.options.left,t.css({top:i+this.options.left,left:o*(this.options.width+this.options.left)})},o.prototype.getMinHeightIndex=function(t){if(Array.indexOf){var e=this.arrHeight.indexOf(t);return e}for(var i=0;i<this.arrHeight.length;i++)if(this.arrHeight[i]===t)return i;return-1},o.prototype.remote=function(){if(!this.noMore&&!this.loading){var e=this;this.loading=!0,t.get(this.options.url,{rnd:Math.random(),page:this.page++,pageSize:this.options.pageSize}).done(function(t){return t&&0!==t.length?(e.options.loaded.call(e,e.$element,t),void(e.loading=!1)):(e.noMore=!0,!1)}).fail(function(){i.error("网络错误！"),e.loading=!1})}},o.prototype.destory=function(){this.infiniteScroll.destory()},o.prototype.imgLoad=function(t,e,i){var o=new Image,s=this;o.onload=function(){t.attr("src",e),i(s.zoom(o.width,o.height))},o.onerror=function(){i({width:s.options.width,height:300})},o.src=e},o.prototype.zoom=function(t,e){var i;return t>e||t==e?(i=t/e,e=this.options.width/i):(i=e/t,e=this.options.width*i),{width:this.options.width,height:e}},o.prototype.getMinHeight=function(){return Math.min.apply(null,this.arrHeight)},o.prototype.getMaxHeight=function(){return Math.max.apply(null,this.arrHeight)},o.prototype.adpHeight=function(){this.$element.height(this.getMaxHeight())},o}),define("km/window",["jquery","km/dragdrop","km/popTips","km/loading"],function($,DragDrop,popTips,Loading){var Window=function(t){this.options=$.extend(!0,{id:null,url:null,params:null,title:"弹出框",content:null,width:"600",height:null,backdrop:!0,backdropClose:!1,iframe:!1,appendTo:document.body,showFooter:!0,borderRadius:"6px",btns:[]},t),this._event={open:$.noop,ok:$.noop,close:$.noop,afterClose:$.noop},this.isClose=!0,this.loading=!1,this.template='<div class="k-window" id="k-window-'+(this.options.id||ids.get())+'"><h4 class="k-window-header"><span class="k-window-title"></span><span class="k-window-close" role="KWINCLOSE">×</span></h4><div class="k-window-container"></div><div class="k-window-footer"><button type="button" class="k-btn k-btn-primary k-window-ok" role="KWINOK">确定</button><button type="button" class="k-btn k-btn-default k-window-cancel" role="KWINCLOSE">取消</button></div></div>',this.backdrop='<div class="k-window-backdrop"></div>',this.$document=$(document),this.$window=$(window),this.init()};Window.prototype.init=function(){this.build(),this.setTitle(this.options.title),this.options.iframe?(this.$container.css({padding:0,overflowY:"hidden"}).append('<iframe frameborder="0" width="100%" src="'+this.options.url+'" scrolling="auto"></iframe>'),this.$iframe=this.$container.find("iframe")):this.setContent(this.options.content),this.eventBind()},Window.prototype.eventBind=function(){var t=this;if(this.$window.on("resize.window",function(){t.layout()}),this.$backdrop.on("click.window",function(){t.options.backdropClose&&t.close()}),this.$win.on("click.window","[role=KWINCLOSE]",function(){t._event.close.call(t)!==!1&&t.close()}).on("click.window","[role=KWINOK]",function(){t._event.ok.call(t)!==!1&&t.close()}),this.options.btns&&this.options.btns.length>0)for(var e,i=0;i<this.options.btns.length;i++)e=this.options.btns[i],this.$win.on("click.window","[role="+e.actionCode+"]",function(){e.func.call(t,t.$iframe)})},Window.prototype.on=function(t,e){return this._event[t]=e||$.noop,this},Window.prototype.setTitle=function(t){this.$header.find(".k-window-title").text(t)},Window.prototype.setContent=function(t){t=t||this.options.content,this.$container.html(t)},Window.prototype.setSize=function(t){this.options.width=t.width,this.options.height=t.height,this.$win.css(t)},Window.prototype.remote=function(){if("string"==typeof this.options.url&&null==this.options.content&&!this.options.iframe){var t=this,e=$.Deferred();return this.loading=!0,this.$container.load(this.options.url+"?rnd="+Math.random(),this.options.params,function(){t.loading=!1,e.resolve()}),e.promise()}},Window.prototype.open=function(){var t=this;Loading.show(),$.when(this.remote()).done(function(){if(t.options.iframe){var e=t.options.url;e+=-1!=e.indexOf("?")?"&rand="+Math.random():"?rand="+Math.random(),t.$iframe.attr("src",e),t.bindIframeLoad||t.$iframe.on("load",function(){t.show(),t.bindIframeLoad=!0})}else t.show()})},Window.prototype.close=function(){this.isClose=!0,this.$win.css({left:"-900px",top:"-900px"}),this.$backdrop.hide(),zIndex.pop(),this._event.afterClose.call(self)},Window.prototype.show=function(){this.isClose=!1,this.$win.show(),this.options.backdrop&&this.$backdrop.show(),this.layout(),this._event.open(this.$win);var t=zIndex.get();this.$win.css("zIndex",t),this.$backdrop.css("zIndex",--t),Loading.hide()},Window.prototype.layout=function(){if(!this.isClose){var t,e,i=this.$window.height(),o=i-100,s=this.$header.height(),n=this.options.showFooter?this.$footer.height():4,a=o-s-n;this.options.height?o<this.options.height?(t=o,e=a):(t=this.options.height,e=t-s-n):(this.orgHeight=this.orgHeight||this.$win.height(),o<this.orgHeight?(t=o,e=a):(t=this.orgHeight,e=this.orgHeight-s-n)),this.$container.css("height",e),this.options.iframe&&this.$container.find("iframe").height(e),this.$win.css({left:"50%",top:"50%",height:t,marginLeft:-this.options.width/2,marginTop:-t/2})}},Window.prototype.build=function(){if(this.$win=$(this.template).css({width:this.options.width,height:this.options.height,borderRadius:this.options.borderRadius}).data("window",this),this.$backdrop=$(this.backdrop),this.$header=this.$win.find(".k-window-header"),this.$container=this.$win.find(".k-window-container"),this.$footer=this.$win.find(".k-window-footer"),this.$win.appendTo(this.options.appendTo),this.$backdrop.appendTo(this.options.appendTo),this.options.showFooter||this.$footer.hide(),this.options.btns&&this.options.btns.length>0){this.$footer.find(".k-btn").hide();for(var t,e=[],i=0;i<this.options.btns.length;i++)t=this.options.btns[i],e.push('<button type="button" class="k-btn '+(t.className||"k-btn-primary")+'" role="'+t.actionCode+'">'+t.text+"</button>");this.$footer.append(e.join(""))}},Window.alert=function(t,e,i){$.isFunction(e)&&(i=e,e=t,t="提示");var o=window.winAlert;o||(o=new Window({width:400,backdropClose:!1}),o.$win.find(".window-cancel").hide(),window.winAlert=o),o.$win.find(".k-window-cancel").hide(),o.setTitle(t),o.setContent(e),o.on("ok",i||$.noop),o.open()},Window.confirm=function(t,e,i,o){$.isFunction(e)&&(o=i,i=e,e=t,t="确认提示");var s=window.winConfirm;s||(s=new Window({width:400,backdropClose:!1}),window.winConfirm=s),s.setTitle(t),s.setContent(e),s.on("ok",i||$.noop),s.on("close",o||$.noop),s.open()},Window.close=function(t){$win=$("#k-window-"+t);var e=$win.data("window");e&&e.close(!0)},Window.open=function(t){var e=new Window(t);return e.open(),e},Window.Global=function($elms){$elms=$elms||$("[data-module=window]"),$elms.each(function(){var $elm=$(this),options=$elm.attr("data-options"),url=$elm.attr("data-url"),width=$elm.attr("data-width"),height=$elm.attr("data-height"),iframe=$elm.attr("data-iframe"),title=$elm.attr("data-title")||"模态窗口",content=$elm.attr("data-content"),showFooter=$elm.attr("data-showFooter"),buttons=$elm.attr("data-btns"),onOk=$elm.attr("data-onOk"),onClose=$elm.attr("data-onClose"),onAfterClose=$elm.attr("data-onAfterClose"),data=$elm.data("window");onOk=onOk&&onOk.length>0?eval("(0,"+onOk+")"):$.noop,onClose=onClose&&onClose.length>0?eval("(0,"+onClose+")"):$.noop,onAfterClose=onAfterClose&&onAfterClose.length>0?eval("(0,"+onAfterClose+")"):$.noop,options=options&&options.length>0?eval("(0,"+options+")"):{url:url,title:title,content:content,width:width&&width.length>0?parseInt(width):680,height:height&&height.length>0?parseInt(height):480,showFooter:showFooter&&"false"==showFooter?!1:!0,iframe:iframe&&"false"==iframe?!1:!0,btns:buttons&&buttons.length>0?eval("(0,"+buttons+")"):[]},data||(data=new Window(options),data.on("ok",function(){return onOk.call(this)}).on("close",function(){return onClose.call(this)}).on("afterClose",function(){return onAfterClose.call(this)}),$elm.parent(".k-input-group").on("click.window","button",function(){data.open()}),$elm.data("window",data).on("click",function(){data.open()}))})};var zIndex=function(){var t=[];return{get:function(){var e;return 0===t.length?(e=1e3,t.push(e)):(e=t[t.length-1],e+=2,t.push(e)),e},pop:function(){0!==t.length&&t.pop()}}}(),ids=function(){var t=[];return{get:function(){var e;return 0==t.length?(e=1,t.push(e)):(e=t[t.length-1],e+=1,t.push(e)),e}}}();return Window}),define("km/wordLimit",["jquery"],function($){var WordLimit=function(t,e){this.$element=t,this.options=$.extend(!0,{maxLength:140,feedback:".chars"},e),this.init()};return WordLimit.prototype.init=function(){var t=this;this.maxLength=parseInt(this.$element.attr("maxLength")||this.options.maxLength),this.$feedback=$(this.options.feedback),this.$element.on("keyup.wordlimit",function(){var e=$.trim($(this).val());t.update(e)}),this.update($.trim(this.$element.val()))},WordLimit.prototype.update=function(t){var e=t.length,i=this.maxLength,o=i-e;e>=i&&this.$element.val(t.substring(0,i)),this.$feedback.html(0>o?0:o)},WordLimit.prototype.reset=function(){this.$element.val(""),this.$feedback.html(this.options.maxLength)},WordLimit.Global=function($elements){$elements=$elements||$("input,textarea").filter('[data-module="wordlimit"]'),$elements.each(function(){var $this=$(this),options=$this.attr("data-options"),maxLength=$this.attr("maxLength"),wordLimit=WordLimit.Get($this);options=options&&options.length>0?eval("(0,"+options+")"):{maxLength:maxLength,feedback:$this.attr("data-feedback")},wordLimit||(wordLimit=new WordLimit($this,options),WordLimit.Set($this,wordLimit))})},WordLimit.Get=function(t){return t.data("wordLimit")},WordLimit.Set=function(t,e){t.data("wordLimit",e)},WordLimit.Reset=function(t){t=t||$("input,textarea").filter('[data-module="wordlimit"]'),t.each(function(){var t=WordLimit.Get($(this));t&&t.reset()})},WordLimit}),define("KM",["km/ajax","km/app","km/autoComplete","km/cache","km/clipZoom","km/contextMenu","km/datePicker","km/dragdrop","km/dropdown","km/dropdownDatepicker","km/dropDownTree","km/event","km/focusMap","km/highlight","km/imgPreview","km/infiniteScroll","km/layout","km/lazyload","km/loading","km/magnifier","km/pager","km/panel","km/placeholder","km/popover","km/popTips","km/rating","km/resizable","km/router","km/slider","km/switch","km/tagSelector","km/tooltips","km/tree","km/treeTable","km/upload","km/util","km/validate","km/validateTooltips","km/waterfall","km/window","km/wordLimit"],function(t,e,i,o,s,n,a,h,r,l,d,p,c,u,f,m,g,$,v,w,y,k,b,x,C,T,I,D,P,z,S,F,H,L,B,E,_,N,W,M,O){return window.KM={ajax:t,App:e,autoComplete:i,cache:o,ClipZoom:s,contextMenu:n,DatePicker:a,Dragdrop:h,Dropdown:r,DropdownDatepicker:l,DropDownTree:d,event:p,focusMap:c,highlight:u,imgPreview:f,InfiniteScroll:m,Layout:g,lazyload:$,Loading:v,magnifier:w,Pager:y,Panel:k,placeholder:b,Popover:x,popTips:C,Rating:T,Resizable:I,Router:D,slider:P,Switch:z,tagSelector:S,Tooltips:F,Tree:H,TreeTable:L,Upload:B,Util:E,Validate:_,ValidateTooltips:N,Waterfall:W,Window:M,WordLimit:O}});